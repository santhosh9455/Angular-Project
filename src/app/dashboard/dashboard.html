<app-navbar [sidebarCollapsed]="sidebarCollapsed" (toggleSidebarEvent)="toggleSidebar()">
</app-navbar>
<app-toast></app-toast>
<app-sidebar [collapsed]="sidebarCollapsed" [userRoles]="userRoles" [activeSection]="viewSection ?? ''"
  (sectionChange)="toggleSection($event)">
</app-sidebar>


<body>
  <div class="main-content" [class.collapsed]="sidebarCollapsed">
    <!-- Admin Dashboard Views -->
    <div *ngIf="hasRole('ROLE_ADMIN')" class="hod-dashboard py-5">
      <div class="container mt-4" *ngIf="viewSection === 'dashboard'">
        <div class="row row-cols-1 mt-4 row-cols-md-3 g-4  w-100 justify-content-center">

          <!-- Total Students -->
          <div class="row row-cols-1 row-cols-md-3 w-100 g-4">
            <!-- Total Students -->
            <div class="col">
              <div class="card bg-gradient-primary text-white shadow-lg rounded-4 h-100 border-0">
                <div class="card-body d-flex flex-column justify-content-between">
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-person-bounding-box fs-3 me-3"></i>
                    <h6 class="mb-0 text-uppercase">Total Students</h6>
                  </div>
                  <h2 class="fw-bold text-center">{{ allStudents.length || 0 }}</h2>
                </div>
              </div>
            </div>

            <!-- Total Users -->
            <div class="col">
              <div class="card bg-gradient-success text-white shadow-lg rounded-4 h-100 border-0">
                <div class="card-body d-flex flex-column justify-content-between">
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-person-lines-fill fs-3 me-3"></i>
                    <h6 class="mb-0 text-uppercase">Total Users</h6>
                  </div>
                  <h2 class="fw-bold text-center">{{ allUsers.length || 0 }}</h2>
                </div>
              </div>
            </div>

            <!-- Staff & HOD -->
            <div class="col">
              <div class="card bg-gradient-info text-white shadow-lg rounded-4 h-100 border-0">
                <div class="card-body d-flex flex-column justify-content-between">
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-people-fill fs-3 me-3"></i>
                    <h6 class="mb-0 text-uppercase">Staff & HOD</h6>
                  </div>
                  <h2 class="fw-bold text-center">{{ UsersProfile.length || 0 }}</h2>
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="container my-4">
          <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">
              <div class="card shadow-lg rounded-4 border-0">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title text-primary fw-bold mb-3 text-center">
                    üìä Department-wise Student Count
                  </h5>
                  <div class="position-relative" style="height: 400px;">
                    <canvas baseChart [data]="barChartData" [options]="barChartOptions" [type]="'bar'">
                    </canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Create User -->

      <div *ngIf="viewSection === 'adminCreateUser'" class="card p-3 mb-4">
        <h5 class="text-primary">‚ûï Create User</h5>
        <form (ngSubmit)="submitCreateUser()">
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" [(ngModel)]="newUser.username" name="username" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" [(ngModel)]="newUser.password" name="password" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Role Name</label>
            <select name="roleid" class="form-select" [(ngModel)]="newUser.roleId" name="editRole" required>
              <option value="">-- Select Role --</option>
              <option *ngFor="let role of roles" [value]="role.id">{{ role.role?.startsWith('ROLE_') ?
                role.role.substring(5) : role.role || 'Unknown' }}</option>
            </select>
          </div>
          <button type="submit" class="btn btn-info">Create User</button>
        </form>
      </div>

      <!-- Edit User Modal -->
      <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-info text-white">
              <h5 class="modal-title icon-edit" id="editUserModalLabel">Edit User</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form (ngSubmit)="submitUserUpdate()">
              <div class="modal-body">
                <div class="mb-3">
                  <label class="form-label">Username</label>
                  <input type="text" class="form-control" [(ngModel)]="editUser.username" name="editUsername" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Password</label>
                  <input type="password" class="form-control" [(ngModel)]="editUser.password" name="editPassword"
                    required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Role Name</label>
                  <select name="roleid" class="form-select" [(ngModel)]="editUser.roleId" name="editRole" required>
                    <option value="">-- Select Role --</option>
                    <option *ngFor="let role of roles" [value]="role.id">{{ role.role?.startsWith('ROLE_') ?
                      role.role.substring(5) : role.role || 'Unknown' }}</option>
                  </select>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Update User</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Create User Modal -->
      <div class="modal fade" id="createUserModal" tabindex="-1" aria-labelledby="createUserModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content shadow">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title" id="createUserModalLabel">‚ûï Create New User</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <form #form="ngForm" (ngSubmit)="submitCreateUser()" novalidate>

              <div class="modal-body">
                <div class="row g-3">
                  <!-- Username -->
                  <div class="col-md-6">
                    <label class="form-label">Username</label>
                    <input #username="ngModel" type="text" class="form-control" [(ngModel)]="newUser.username"
                      name="username" required />
                    <div class="text-danger" *ngIf="(form.submitted || username.touched) && username.invalid">
                      Username is required
                    </div>
                  </div>

                  <!-- Password -->
                  <div class="col-md-6">
                    <label class="form-label">Password</label>
                    <input #password="ngModel" type="password" class="form-control" [(ngModel)]="newUser.password"
                      name="password" required />
                    <div class="text-danger" *ngIf="(form.submitted || password.touched) && password.invalid">
                      Password is required
                    </div>

                  </div>

                  <!-- Role -->
                  <div class="col-md-6">
                    <label class="form-label">Role</label>
                    <select class="form-select" [(ngModel)]="newUser.roleId" name="roleId" required>
                      <option [ngValue]="null">Select Role</option>
                      <option *ngFor="let role of roles" [ngValue]="role.id">
                        {{ role.role.replace('ROLE_', '') }}
                      </option>

                    </select>
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-primary" [disabled]="!form.valid">Create User</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>

              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- All Users -->
      <div *ngIf="viewSection === 'adminAllUsers'" class="px-3 py-2">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="text-primary fw-bold"> All Users</h5>
          <button class="btn btn-success" (click)="openCreateUserModal()">
            <i class="bi bi-person-plus-fill me-1"></i> Add User
          </button>
        </div>

        <!-- Filters -->
        <div class="row g-2 mb-3">
          <div class="col-md-6">
            <input type="text" class="form-control" placeholder=" Search username" [(ngModel)]="searchText"
              (ngModelChange)="onFilterChange()" />
          </div>
          <div class="col-md-6">
            <select class="form-select" [(ngModel)]="userFilterRoleId" (change)="onFilterChange()">
              <option [ngValue]="null">All Roles</option>
              <option *ngFor="let role of roles" [ngValue]="role.id">{{ role.role?.startsWith('ROLE_') ?
                role.role.substring(5) : role.role || 'Unknown' }}</option>
            </select>
          </div>
        </div>

        <!-- Table -->
        <table class="table table-bordered table-hover text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Username</th>
              <th>Role</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of allUsers; let i = index">
              <td>{{ (page * size) + i + 1 }}</td>
              <td>{{ user.username }}</td>
              <td>
                <span class="badge"
                  [ngClass]="{'bg-primary': user.role === 'ROLE_ADMIN','bg-warning text-dark': user.role === 'ROLE_STAFF','bg-success': user.role === 'ROLE_STUDENT','bg-secondary': user.role === 'ROLE_HOD'}">
                  {{ user.role.startsWith('ROLE_') ? user.role.substring(5) : user.role || 'Unknown' }}
                </span>
              </td>

              <td>
                <button class="btn btn-outline-warning btn-sm " (click)="openEditUserModel(user)">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm ms-2" (click)="deleteUserAuthSwal(user.id)">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="allUsers.length === 0">
              <td colspan="4" class="text-muted">No users found.</td>
            </tr>
          </tbody>
        </table>

        <!-- Pagination -->
        <nav *ngIf="totalPages > 1">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="page === 0">
              <a class="page-link" (click)="onPageChange(page - 1)">Previous</a>
            </li>
            <li class="page-item disabled">
              <span class="page-link">Page {{ page + 1 }} of {{ totalPages }}</span>
            </li>
            <li class="page-item" [class.disabled]="page + 1 >= totalPages">
              <a class="page-link" (click)="onPageChange(page + 1)">Next</a>
            </li>
          </ul>
        </nav>
      </div>

      <!-- All Staff & Hod -->
      <div *ngIf="viewSection === 'adminAllStaffHod'" class="px-2 py-3">
        <!-- Header + Add Button -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="text-primary fw-bold mb-0"> All Staff & HOD</h5>
          <button class="btn btn-success" (click)="openCreateUserProModal()">
            <i class="bi bi-person-plus-fill me-1"></i> Add HOD / Staff
          </button>
        </div>

        <!-- Filters -->
        <div class="row g-2 mb-3">
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder=" Search by name or username" [(ngModel)]="searchText"
              (input)="onFilterChange()" />
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterRole" (change)="onFilterChange()">
              <option value="">All Roles</option>
              <option value="ROLE_STAFF">STAFF</option>
              <option value="ROLE_HOD">HOD</option>
            </select>
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterDepartment" (change)="onFilterChange()">
              <option [ngValue]="null">All Departments</option>
              <option *ngFor="let dept of departments" [ngValue]="dept.id">{{ dept.departmentName }}
              </option>
            </select>
          </div>
        </div>

        <!-- Table -->
        <table class="table table-hover table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Role</th>
              <th>Username</th>
              <th>Phone</th>
              <th>Department</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of UsersProfile; let i = index">
              <td>{{ i + 1 + (page * size) }}</td>
              <td>{{ user.name || 'N/A'}}</td>
              <td>
                <span
                  class="badge bg-{{ user.role === 'ROLE_HOD' ? 'success' : user.role === 'ROLE_STAFF' ? 'warning text-dark' : 'danger' }}">
                  {{ user.role?.startsWith('ROLE_') ? user.role?.substring(5)
                  : user.role
                  || 'N/A' }}
                </span>
              </td>
              <td>{{ user.username || 'N/A' }}</td>
              <td>{{ user.phoneNumber || 'N/A' }}</td>
              <td>{{ user.departmentName || 'N/A' }}</td>
              <td>
                <button class="btn btn-outline-info btn-sm me-1" (click)="viewUsersProfile(user)">
                  <i class="bi bi-eye-fill"></i>
                </button>
                <button class="btn btn-outline-warning btn-sm me-1" (click)="openEditUserModal(user)">
                  <i class="bi bi-pencil-fill"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm" (click)="deleteUserSwal(user.id)">
                  <i class="bi bi-trash3-fill"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="UsersProfile.length === 0">
              <td colspan="7" class="text-muted">No users found.</td>
            </tr>
          </tbody>
        </table>
        <!-- Pagination Controls -->
        <nav *ngIf="totalPages > 1">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="page === 0">
              <button type="button" class="page-link" (click)="onPageChange(page - 1)">Previous</button>
            </li>
            <li class="page-item disabled">
              <span class="page-link">Page {{ page + 1 }} of {{ totalPages }}</span>
            </li>
            <li class="page-item" [class.disabled]="page + 1 >= totalPages">
              <button type="button" class="page-link" (click)="onPageChange(page + 1)">Next</button>
            </li>
          </ul>
        </nav>


        <!-- Create User Modal -->
        <div class="modal fade" id="createUserProModal" tabindex="-1" aria-labelledby="createUserModalLabel"
          aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content shadow">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="createUserModalLabel">‚ûï Create HOD / Staff</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                  aria-label="Close"></button>
              </div>
              <form #form="ngForm" (ngSubmit)="submitCreateUserPro()" novalidate>

                <div class="modal-body">
                  <div class="row g-3">
                    <!-- Name -->
                    <div class="col-md-6">
                      <label class="form-label">Name</label>
                      <input type="text" class="form-control" name="name" required [(ngModel)]="newUserPro.name"
                        #name="ngModel" />
                      <div class="text-danger" *ngIf="(form.submitted || name.touched) && name.invalid">
                        Name is required
                      </div>
                    </div>

                    <!-- Email -->
                    <div class="col-md-6">
                      <label class="form-label">Email</label>
                      <input type="email" class="form-control" name="email" required [(ngModel)]="newUserPro.email"
                        #email="ngModel" />
                      <div class="text-danger" *ngIf="(form.submitted || email.touched) && email.invalid">
                        Valid email is required
                      </div>
                    </div>

                    <!-- Phone -->
                    <div class="col-md-6">
                      <label class="form-label">Phone Number</label>
                      <input type="text" class="form-control" name="phoneNumber" required pattern="^[0-9]{10}$"
                        [(ngModel)]="newUserPro.phoneNumber" #phoneNumber="ngModel" />
                      <div class="text-danger" *ngIf="(form.submitted || phoneNumber.touched) && phoneNumber.invalid">
                        Enter valid 10-digit phone number
                      </div>
                    </div>

                    <!-- Gender -->
                    <div class="col-md-6">
                      <label class="form-label">Gender</label>
                      <select class="form-select" name="gender" required [(ngModel)]="newUserPro.gender"
                        #gender="ngModel">
                        <option value="">-- Select Gender --</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                      </select>
                      <div class="text-danger" *ngIf="(form.submitted || gender.touched) && gender.invalid">
                        Gender is required
                      </div>
                    </div>

                    <!-- DOB -->
                    <div class="col-md-6">
                      <label class="form-label">Date of Birth</label>
                      <input type="date" class="form-control" name="dateOfBirth" required
                        [(ngModel)]="newUserPro.dateOfBirth" #dateOfBirth="ngModel" />
                      <div class="text-danger" *ngIf="(form.submitted || dateOfBirth.touched) && dateOfBirth.invalid">
                        Date of birth is required
                      </div>
                    </div>

                    <!-- Role -->
                    <div class="col-md-6">
                      <label class="form-label">Role</label>
                      <select class="form-select" name="roleId" required [(ngModel)]="newUserPro.roleId"
                        #roleId="ngModel">
                        <option value="">-- Select Role --</option>
                        <ng-container *ngFor="let role of roles">
                          <option *ngIf="role.role === 'ROLE_HOD' || role.role === 'ROLE_STAFF'" [value]="role.id">
                            {{ role.role.startsWith('ROLE_') ? role.role.substring(5) : role.role || 'N/A' }}
                          </option>
                        </ng-container>
                      </select>
                      <div class="text-danger" *ngIf="(form.submitted || roleId.touched) && roleId.invalid">
                        Role is required
                      </div>
                    </div>

                    <!-- Department (optional but can add required if needed) -->
                    <div class="col-md-6">
                      <label class="form-label">Department</label>
                      <select class="form-select" [(ngModel)]="newUserPro.departmentId" name="departmentId"
                        #departmentId="ngModel">
                        <option value="">-- Select Department --</option>
                        <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.departmentName
                          }}</option>
                      </select>
                      <div class="text-danger" *ngIf="(form.submitted || departmentId.touched) && departmentId.invalid">
                        Department is required
                      </div>
                    </div>

                    <!-- Subject (optional) -->
                    <div class="col-md-6">
                      <label class="form-label">Subject</label>
                      <select class="form-select" [(ngModel)]="newUserPro.subjectId" name="subjectId">
                        <option value="">-- Select Subject --</option>
                        <option *ngFor="let subject of subjects" [value]="subject.id">{{
                          subject.subjectName }}</option>
                      </select>
                    </div>

                    <!-- Course (optional) -->
                    <div class="col-md-6">
                      <label class="form-label">Course</label>
                      <select class="form-select" [(ngModel)]="newUserPro.courseId" name="courseId">
                        <option value="">-- Select Course --</option>
                        <option *ngFor="let course of Courses" [value]="course.id">{{ course.courseName }}
                        </option>
                      </select>
                    </div>

                  </div>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-success" [disabled]="form.invalid">Create</button>
                  <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Edit User Modal -->
        <div class="modal fade" id="editUserProModal" tabindex="-1" aria-labelledby="editUserProModalLabel"
          aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content rounded-4 shadow">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="editUserProModalLabel">
                  <i class="bi bi-pencil-square me-2"></i> Edit User Profile
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                  (click)="closeModal()"></button>
              </div>

              <form #editUserForm="ngForm" (ngSubmit)="updateUserPartial()" novalidate>
                <div class="modal-body">
                  <div class="row g-3">
                    <!-- Name -->
                    <div class="col-md-6">
                      <label for="editName" class="form-label">Name</label>
                      <input id="editName" name="name" #name="ngModel" type="text" class="form-control"
                        [(ngModel)]="editUserPro.name" required />

                    </div>

                    <div class="col-md-6">
                      <label for="editEmail" class="form-label">Email</label>
                      <input id="editEmail" name="email" type="email" class="form-control"
                        [(ngModel)]="editUserPro.email" required email #email="ngModel" />

                    </div>


                    <!-- Phone -->
                    <div class="col-md-6">
                      <label for="editPhone" class="form-label">Phone</label>
                      <input id="editPhone" name="phoneNumber" type="text" class="form-control"
                        [(ngModel)]="editUserPro.phoneNumber" required #phoneNumber="ngModel" />

                    </div>

                    <!-- Gender -->
                    <div class="col-md-6">
                      <label for="editGender" class="form-label">Gender</label>
                      <select id="editGender" name="gender" class="form-select" [(ngModel)]="editUserPro.gender"
                        required #gender="ngModel">
                        <option value="">Select</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                      </select>

                    </div>

                    <!-- DOB -->
                    <div class="col-md-6">
                      <label for="editDOB" class="form-label">Date of Birth</label>
                      <input id="editDOB" name="dateOfBirth" type="date" class="form-control"
                        [(ngModel)]="editUserPro.dateOfBirth" required #dateOfBirth="ngModel" />

                    </div>

                    <!-- Department -->
                    <div class="col-md-6">
                      <label for="editDepartment" class="form-label">Department</label>
                      <select id="editDepartment" name="departmentId" class="form-select"
                        [(ngModel)]="editUserPro.departmentId" required #departmentId="ngModel">
                        <option [ngValue]="null">Select Department</option>
                        <option *ngFor="let dept of departments" [ngValue]="dept.id">{{
                          dept.departmentName }}</option>
                      </select>

                    </div>

                    <!-- Subject -->
                    <div class="col-md-6">
                      <label for="editSubject" class="form-label">Subject</label>
                      <select id="editSubject" name="subjectId" class="form-select" [(ngModel)]="editUserPro.subjectId">
                        <option [ngValue]="null">-- Optional --</option>
                        <option *ngFor="let subj of subjects" [ngValue]="subj.id">{{ subj.subjectName }}
                        </option>
                      </select>
                    </div>

                    <!-- Course -->
                    <div class="col-md-6">
                      <label for="editCourse" class="form-label">Course</label>
                      <select id="editCourse" name="courseId" class="form-select" [(ngModel)]="editUserPro.courseId">
                        <option [ngValue]="null">-- Optional --</option>
                        <option *ngFor="let course of courses" [ngValue]="course.id">{{ course.courseName
                          }}</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">User Name</label>
                      <input type="text" class="form-control" name="username" required
                        [(ngModel)]="editUserPro.username" #username="ngModel" />
                    </div>
                  </div>

                </div>

                <div class="modal-footer">
                  <button class="btn btn-secondary" type="button" data-bs-dismiss="modal"
                    (click)="closeModal()">Cancel</button>
                  <button class="btn btn-primary" type="submit">
                    <i class="bi bi-save me-1"></i> Save Changes
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- View User Profile Modal -->
        <div class="modal fade" id="viewUserProModal" tabindex="-1" aria-labelledby="viewUserProModal"
          aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">

              <!-- Modal Header -->
              <div class="modal-header bg-info text-white">
                <h5 class="modal-title">üéì Staff / HOD Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

              <!-- Modal Body -->
              <div class="modal-body">
                <div class="container-fluid">

                  <!-- Profile Image and Basic -->
                  <div class="row mb-3">
                    <div class="col text-center">
                      <img [src]="'http://localhost:8080/uploads/assets/default-profile.png'" alt="Profile"
                        class="rounded-circle shadow" width="100" height="100">
                      <h5 class="mt-2 text-dark">{{ selectedUserProfile?.name }}</h5>
                      
                      <span class="badge bg-primary">{{ selectedUserProfile?.username }}</span>
                    </div>
                  </div>

                  <!-- Info Cards -->
                  <div class="row g-4">

                    <!-- Contact Info -->
                    <div class="col-md-6">
                      <div class="card info-card border-0 shadow-sm violet-card text-white" style="height: 217px;">
                        <div class="card-body">
                          <h5 class="card-title mb-3"><i class="bi bi-envelope-fill me-2"></i>Contact Info
                          </h5>
                          <p class="mb-2">
                            <i class="bi bi-envelope-open me-2"></i><strong>Email:</strong>
                            {{ selectedUserProfile?.email }}
                          </p>
                          <p>
                            <i class="bi bi-telephone-fill me-2"></i><strong>Phone:</strong>
                            {{ selectedUserProfile?.phoneNumber }}
                          </p>
                        </div>
                      </div>
                    </div>

                    <!-- Personal Info -->
                    <div class="col-md-6">
                      <div class="card info-card border-0 shadow-sm violet-card text-white">
                        <div class="card-body">
                          <h5 class="card-title mb-3"><i class="bi bi-person-fill me-2"></i>Personal Info
                          </h5>
                          <p class="mb-2">
                            <i class="bi bi-gender-ambiguous me-2"></i><strong>Gender:</strong>
                            {{ selectedUserProfile?.gender || 'N/A'}}
                          </p>
                          <p>
                            <i class="bi bi-calendar-fill me-2"></i><strong>Age:</strong>
                            {{ selectedUserProfile?.age || 'N/A'}}
                          </p>
                          <p>
                            <i class="bi bi-building-fill me-2"></i><strong>Date of Birth:</strong>
                            {{ selectedUserProfile?.dateOfBirth || 'N/A' }}
                          </p>
                        </div>
                      </div>
                    </div>

                    <!-- Academic Info -->
                    <div class="col-md-12">
                      <div class="card info-card border-0 shadow-sm violet-card text-white">
                        <div class="card-body">
                          <h5 class="card-title mb-3"><i class="bi bi-journal-text me-2"></i>Academic Info
                          </h5>
                          <div class="row">
                            <div class="col-md-4 mb-2">
                              <i class="bi bi-book me-2"></i><strong>Course:</strong>
                              {{ selectedUserProfile?.courseName || 'Not Assigned' }}
                            </div>
                            <div class="col-md-4 mb-2">
                              <i class="bi bi-easel2-fill me-2"></i><strong>Subject:</strong>
                              {{ selectedUserProfile?.subjectName || 'Not Assigned' }}
                            </div>
                            <div class="col-md-4 mb-2">
                              <i class="bi bi-building me-2"></i><strong>Department:</strong>
                              {{ selectedUserProfile?.departmentName || 'Not Assigned' }}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div> <!-- row -->

                </div> <!-- container-fluid -->
              </div> <!-- modal-body -->

              <!-- Modal Footer -->
              <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>

            </div>
          </div>
        </div>

        <!-- Full View of Staff and Admin-->

      </div>
      <!-- All Students -->
      <div *ngIf="viewSection === 'adminAllStudents'" class="px-3 py-2">
        <!-- Header and Add Button -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="text-primary">üéì All Students</h5>
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createStudentModal">
            <i class="bi bi-person-plus-fill me-1"></i> Add Student
          </button>
        </div>

        <!-- Filters -->
        <div class="row g-2 mb-3">
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder=" Name or Username" [(ngModel)]="searchText"
              (ngModelChange)="onFilterChange()" />
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterDepartment" (change)="onFilterChange()">
              <option [ngValue]="null">All Departments</option>
              <option *ngFor="let d of departments" [ngValue]="d.id">{{ d.departmentName }}</option>
            </select>
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterStatus" (change)="onFilterChange()">
              <option value="">All Status</option>
              <option value="PENDING">Pending</option>
              <option value="APPROVED">Approved</option>
              <option value="REJECTED">Rejected</option>
            </select>
          </div>
        </div>

        <!-- Table -->
        <div class="table-responsive">
          <table class="table table-bordered table-hover text-center align-middle">
            <thead class="table-light">
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Username</th>
                <th>Phone</th>
                <th>Department</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of students; let i = index">
                <td>{{ (page * size) + i + 1 }}</td>
                <td>{{ student.name || 'N/A' }}</td>
                <td>{{ student.username || 'N/A' }}</td>
                <td>{{ student.phoneNumber || 'N/A' }}</td>
                <td>{{ student.departmentName || 'N/A' }}</td>
                <td>
                  <span
                    class="badge bg-{{ student.status === 'APPROVED' ? 'success' : student.status === 'PENDING' ? 'warning text-dark' : 'danger' }}">
                    {{ student.status }}
                  </span>
                </td>
                <td class="d-flex justify-content-center gap-2">
                  <button class="btn btn-outline-info btn-sm" (click)="viewStudentProfile(student)">
                    <i class="bi bi-eye"></i>
                  </button>
                  <button class="btn btn-outline-warning btn-sm" (click)="openEditStudentModal(student)">
                    <i class="bi bi-pencil-square"></i>
                  </button>
                  <button class="btn btn-outline-danger btn-sm" (click)="deleteStudentSwal(student.id)">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
              <tr *ngIf="students.length === 0">
                <td colspan="7" class="text-muted">No students found.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <nav *ngIf="totalPages > 1" class="mt-2">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="page === 0">
              <button type="button" class="page-link" (click)="onPageChange(page - 1)">Previous</button>
            </li>
            <li class="page-item disabled">
              <span class="page-link">Page {{ page + 1 }} of {{ totalPages }}</span>
            </li>
            <li class="page-item" [class.disabled]="page + 1 >= totalPages">
              <button type="button" class="page-link" (click)="onPageChange(page + 1)">Next</button>
            </li>
          </ul>
        </nav>
      </div>


      <!-- Update Student -->
      <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <form (ngSubmit)="AdminsubmitUpdateStudent()">
              <div class="modal-header">
                <h5 class="modal-title" id="editStudentModalLabel">‚úç Update Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.name" name="studentName"
                      required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Age</label>
                    <input type="number" class="form-control" [(ngModel)]="studentEdit.age" name="studentAge" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Gender</label>
                    <select class="form-select" [(ngModel)]="studentEdit.gender" name="studentGender">
                      <option value="">-- Select Gender --</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" [(ngModel)]="studentEdit.email" name="studentEmail"
                      required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" [(ngModel)]="studentEdit.phoneNumber" name="studentPhone" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Department</label>
                    <select class="form-select" [(ngModel)]="studentEdit.departmentId" name="studentDepartment">
                      <option value="">-- Select Department --</option>
                      <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.departmentName }}
                      </option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Course Name</label>
                    <select class="form-select" [(ngModel)]="studentEdit.courseId" name="studentCourse">
                      <option value="">-- Select Course --</option>
                      <option *ngFor="let course of hodCourses" [value]="course.id">{{ course.courseName
                        }}</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Subject</label>
                    <select class="form-select" [(ngModel)]="studentEdit.subjectId" name="studentSubject">
                      <option value="">-- Select Subject --</option>
                      <option *ngFor="let subject of subjects" [value]="subject.id">{{ subject.subjectName
                        }}</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Status</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.active" name="studentStatus" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Course Status</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.courseStatus"
                      name="studentCourseStatus" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Profile Image</label>
                    <input type="file" class="form-control" (change)="onProfileImageSelected($event)">
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Marksheet Image</label>
                    <input type="file" class="form-control" (change)="onMarksheetImageSelected($event)">
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">User Name</label>
                    <input type="text" class="form-control" name="username" required [(ngModel)]="studentEdit.username"
                      #username="ngModel" />
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Create Student Modal -->
    <div class="modal fade" id="createStudentModal" tabindex="-1" aria-labelledby="createStudentModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <form (ngSubmit)="AdminSubmitCreateStudent()" #createStudentForm="ngForm">
            <div class="modal-header bg-success text-white">
              <h5 class="modal-title" id="createStudentModalLabel">‚ûï Create New Student</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <div class="row">
                <!-- Name -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Name</label>
                  <input #name="ngModel" type="text" class="form-control" [(ngModel)]="newStudent.name" name="name"
                    required />
                  <div>
                    <span class="text-danger" *ngIf="name.invalid && (name.dirty || name.touched)"> Name is
                      required</span>
                  </div>
                </div>

                <!-- Age -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Age</label>
                  <input #age="ngModel" type="number" class="form-control" [(ngModel)]="newStudent.age" name="age" />
                  <div>
                    <span class="text-danger" *ngIf="age.invalid && (age.dirty || age.touched)"> Age is required</span>
                  </div>
                </div>

                <!-- Gender -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Gender</label>
                  <select class="form-select" [(ngModel)]="newStudent.gender" name="gender" required>
                    <option value="">-- Select Gender --</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                  </select>
                </div>

                <!-- Email -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Email</label>
                  <input #email="ngModel" type="email" class="form-control" [(ngModel)]="newStudent.email" name="email"
                    required />
                  <div>
                    <span class="text-danger" *ngIf="email.invalid && (email.dirty || email.touched)"> Valid email is
                      required</span>
                  </div>
                </div>

                <!-- Phone -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Phone Number</label>
                  <input #phoneNumber="ngModel" type="tel" class="form-control" [(ngModel)]="newStudent.phoneNumber"
                    name="phoneNumber" />
                  <div>
                    <span class="text-danger" *ngIf="phoneNumber.invalid && (phoneNumber.dirty || phoneNumber.touched)">
                      Valid phone number is required</span>
                  </div>
                </div>

                <!-- Department -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Department</label>
                  <select class="form-select" [(ngModel)]="newStudent.departmentId" name="departmentId" required>
                    <option value="">-- Select Department --</option>
                    <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.departmentName }}</option>
                  </select>
                </div>

                <!-- Profile Image -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Profile Image</label>
                  <input type="file" class="form-control" (change)="onProfileImageSelected2($event)" />
                </div>

                <!-- Marksheet Image -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Marksheet Image</label>
                  <input type="file" class="form-control" (change)="onMarksheetImageSelected2($event)" />
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button type="submit" class="btn btn-success">Create Student</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- View Student Profile Modal -->

    <div class="modal fade" id="viewStudentModal" tabindex="-1" aria-labelledby="viewStudentModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content rounded-4 shadow-lg border-0">
          <div class="modal-header bg-gradient bg-info text-white">
            <h5 class="modal-title" id="viewStudentModalLabel">
              <i class="bi bi-person-circle me-2"></i> Student Full Profile
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body p-4">
            <!-- Top: Profile + Info -->
            <div class="row">
              <!-- Profile Image -->
              <div class="col-md-4 text-center mb-4">
                <img
                  [src]="selectedStudent?.profileImagePath ? 'http://localhost:8080' + selectedStudent.profileImagePath : 'http://localhost:8080/uploads/assets/default-profile.png'"
                  alt="Profile" class="rounded-circle shadow mb-3"
                  style="width: 150px; height: 150px; object-fit: cover;" />
                <h5 class="fw-semibold mt-2">{{ selectedStudent?.name }}</h5>
                <p class="text-muted mb-1">{{ selectedStudent?.email }}</p>
                <span
                  class="badge bg-{{ selectedStudent?.status === 'APPROVED' ? 'success' : selectedStudent?.status === 'PENDING' ? 'warning text-dark' : 'danger' }}">
                  {{ selectedStudent?.status }}
                </span>
              </div>

              <!-- Details -->
              <div class="col-md-8">
                <div class="card border-0 shadow-sm rounded-4">
                  <div class="card-body p-4">
                    <h5 class="mb-3 text-primary"><i class="bi bi-person-lines-fill me-2"></i>Student
                      Details</h5>
                    <div class="row g-3">
                      <!-- Column 1 -->
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Student ID</p>
                        <h6>{{ selectedStudent?.id }}</h6>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Username</p>
                        <h6>{{ selectedStudent?.username }}</h6>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Phone</p>
                        <h6>{{ selectedStudent?.phoneNumber }}</h6>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Gender</p>
                        <h6>{{ selectedStudent?.gender }}</h6>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Age</p>
                        <h6>{{ selectedStudent?.age }}</h6>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Department</p>
                        <h6>{{ selectedStudent?.departmentName }}</h6>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Subject</p>
                        <h6>{{ selectedStudent?.subjectName || '‚Äî' }}</h6>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Course</p>
                        <h6>{{ selectedStudent?.courseName || '‚Äî' }}</h6>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Course Status</p>
                        <h6>{{ selectedStudent?.courseStatus || '‚Äî' }}</h6>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <!-- Divider -->
            <hr class="my-4" />

            <!-- Marksheet -->
            <div class="text-center">
              <h6 class="text-muted mb-2">Marksheet Preview</h6>
              <img
                [src]="selectedStudent?.marksheetImagePath ? 'http://localhost:8080' + selectedStudent.marksheetImagePath : 'http://localhost:8080/uploads/assets/default-marksheet.png'"
                alt="Marksheet" class="img-fluid rounded shadow" style="max-height: 500px;" />
            </div>
          </div>

          <div class="modal-footer bg-light border-top-0">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
              <i class="bi bi-x-lg me-1"></i> Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- End Admin View -->


    <!-- HOD View Section -->
    <div *ngIf="hasRole('ROLE_HOD')" class="hod-dashboard py-5">
      <!-- Requested Students Table -->
      <div *ngIf="viewSection === 'hodRequested'">
        <h5 class="text-primary fw-bold mb-3"> Requested Students</h5>
        
        <ng-container *ngIf="hodRequested?.length && hodRequested.length > 0; else noRequested">
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Department</th>
                <th>Status </th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of hodRequested; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.name }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.phoneNumber }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.status }}</td>
                <td>
                  <button class="btn btn-success btn-sm me-2"
                    (click)="confirmStudentAction(student.id, 'approve')">Approve</button>
                  <button class="btn btn-danger btn-sm"
                    (click)="confirmStudentAction(student.id, 'reject')">Reject</button>
                </td>

              </tr>
            </tbody>
          </table>

          
        </ng-container>
        <ng-template #noRequested>
          <p>No requested students found.</p>
        </ng-template>
      </div>


      <!--  Approved Students -->
      <!-- Update Student Modal -->
      <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <form (ngSubmit)="submitUpdateStudent()">
              <div class="modal-header">
                <h5 class="modal-title" id="editStudentModalLabel">‚úç Update Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" name="studentName" required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Age</label>
                    <input type="number" class="form-control" [(ngModel)]="studentEdit.age" name="studentAge" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Gender</label>
                    <select class="form-select" [(ngModel)]="studentEdit.gender" name="studentGender">
                      <option value="">-- Select Gender --</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" [(ngModel)]="studentEdit.email" name="studentEmail"
                      required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Phone Number</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.phoneNumber" name="studentPhone" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Profile Image</label>
                    <input type="file" class="form-control" (change)="onProfileImageSelected($event)">
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Marksheet Image</label>
                    <input type="file" class="form-control" (change)="onMarksheetImageSelected($event)">
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="viewSection === 'hodApproved'">
      <h5 class="text-success fw-bold mb-3"> Approved Students</h5>
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="table-success">
            <tr>
              <th>#</th>
              <th>ID</th>
              <th>Name</th>
              <th>Age</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Course</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of hodApproved; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{student.id}}</td>
              <td>{{ student.name }}</td>
              <td>{{ student.age }}</td>
              <td>{{ student.email }}</td>
              <td>{{ student.phoneNumber }}</td>
              <td>{{ student.courseName }}</td>
              <td>
                <button class="btn btn-success btn-sm me-2" (click)="openEditStudentModal(student)">
                  Edit
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ‚ùå Rejected Students -->
    <div *ngIf="viewSection === 'hodRejected'">
      <h5 class="text-danger fw-bold mb-3">‚ùå Rejected Students</h5>
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="table-danger">
            <tr>
              <th>#</th>
              <th>ID</th>
              <th>Name</th>
              <th>Course</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of hodRejected; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ student.id }}</td>
              <td>{{ student.name }}</td>
              <td>{{ student.courseName }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div *ngIf="viewSection === 'hodCreateStaff'" class="card p-3 mb-4 rounded w-75 mx-auto">
      <h5 class="text-primary">‚ûï Add Staff</h5>
      <form (ngSubmit)="submitCreateStaff()" #staffForm="ngForm" novalidate>

        <div class="mb-3">
          <label class="form-label">Name</label>
          <input type="text" class="form-control" name="name" [(ngModel)]="newStaff.name" required>
          <div class="text-danger" *ngIf="staffForm.submitted && !newStaff.name">Name is required.</div>
        </div>

        <div class="mb-3">
          <label class="form-label">Age</label>
          <input type="number" class="form-control" name="age" [(ngModel)]="newStaff.age" min="18" required>
          <div class="text-danger" *ngIf="staffForm.submitted && (!newStaff.age || newStaff.age < 18)">
            Age must be 18 or older.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Gender</label>
          <select class="form-select" name="gender" [(ngModel)]="newStaff.gender" required>
            <option value="">-- Select Gender --</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>

          </select>
          <div class="text-danger" *ngIf="staffForm.submitted && !newStaff.gender">Gender is required.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" name="email" [(ngModel)]="newStaff.email" required email>
          <div class="text-danger" *ngIf="staffForm.submitted && !staffForm.controls['email']?.valid">
            Valid email is required.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Phone Number</label>
          <input type="text" class="form-control" name="phoneNumber" [(ngModel)]="newStaff.phoneNumber"
            pattern="^[0-9]{10}$" required>
          <div class="text-danger" *ngIf="staffForm.submitted && !staffForm.controls['phoneNumber']?.valid">
            Phone number must be 10 digits.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Subject</label>
          <select class="form-select" [(ngModel)]="newStaff.subjectId" name="subjectId" required>
            <option [ngValue]="null">-- Select Subject --</option>
            <option *ngFor="let subject of hodSubjects" [value]="subject.id">
              {{ subject.subjectName }}
            </option>
          </select>
        </div>


        <div class="mb-3">
          <label class="form-label">Course Name (optional)</label>
          <select class="form-select" [(ngModel)]="updatedStaff.courseName" name="courseName">
            <option value="">-- Select Subject --</option>
            <option *ngFor="let course of hodCourses" [value]="course.id">{{ course.courseName }}</option>
          </select>
        </div>

        <button type="submit" class="btn btn-success">Create Staff</button>
      </form>
    </div>

    <div *ngIf="viewSection === 'hodCreateSubject'" class="card p-3 mb-4">
      <h5 class="text-primary"> Add Subject</h5>
      <form (ngSubmit)="submitCreateSubject()">
        <div class="mb-3">
          <label class="form-label">Subject Name</label>
          <input type="text" class="form-control" [(ngModel)]="newSubjectName" name="subjectName" required>
        </div>
        <button type="submit" class="btn btn-primary">Create Subject</button>
      </form>
    </div>

    <div *ngIf="viewSection === 'hodCreateCourse'" class="card p-3 mb-4">
      <h5 class="text-primary"> Add Course</h5>
      <form (ngSubmit)="submitCreateCourse()">
        <div class="mb-3">
          <label class="form-label">Course Name</label>
          <input type="text" class="form-control" [(ngModel)]="newCourseName" name="courseName" required>
        </div>
        <button type="submit" class="btn btn-primary">Create Course</button>
      </form>
    </div>
    <!-- üìö All Subjects -->

    <!-- Subject Edit Modal -->
    <div class="modal fade" id="editSubjectModal" tabindex="-1" aria-labelledby="editSubjectLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form (ngSubmit)="UpdateHodSubject()">
            <div class="modal-header">
              <h5 class="modal-title" id="editSubjectLabel">Edit Subject</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <label class="form-label">New Subject Name</label>
              <input type="text" class="form-control" [(ngModel)]="updatedSubjectName" name="updatedSubjectName"
                required>
            </div>

            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Save</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div *ngIf="viewSection === 'hodSubjects'">
      <h5 class="text-info fw-bold mb-3">üìö All Subjects</h5>
      <ng-container *ngIf="hodSubjects?.length && hodSubjects.length > 0; else noSubjects">
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead class="table-info">
              <tr>
                <th>#</th>
                <th>ID</th>
                <th>Subject Name</th>
                <th>Department</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let subject of hodSubjects; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ subject.id }}</td>
                <td>{{ subject.subjectName }}</td>
                <td>{{ subject.departmentName }}</td>
                <td>
                  <button class="btn btn-success btn-sm me-2"
                    (click)="openSubjectEditModal(subject.id, subject.subjectName)">
                    Edit
                  </button>

                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>
      <ng-template #noSubjects>
        <p class="text-muted">No subjects found.</p>
      </ng-template>
    </div>

    <!-- üìò All Courses -->
    <div *ngIf="viewSection === 'hodCourses'">
      <h5 class="text-primary fw-bold mb-3">üìò All Courses</h5>
      <ng-container *ngIf="hodCourses?.length && hodCourses.length > 0; else noCourses">
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead class="table-primary">
              <tr>
                <th>#</th>
                <th>Course Name</th>
                <th>Staff Name</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let course of hodCourses; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ course.courseName }}</td>
                <td>{{ course.staffName }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>
      <ng-template #noCourses>
        <p class="text-muted">No courses found.</p>
      </ng-template>
    </div>

    <!-- üë©‚Äçüè´ All Staff -->
    <!-- Edit Staff Modal -->
    <div class="modal fade" id="editStaffModal" tabindex="-1" aria-labelledby="editStaffLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form (ngSubmit)="saveUpdatedStaff()">
            <div class="modal-header">
              <h5 class="modal-title" id="editStaffLabel">Edit Staff</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-2">
                <label>Name</label>
                <input type="text" class="form-control" [(ngModel)]="updatedStaff.name" name="name" required />
              </div>
              <div class="mb-2">
                <label>Email</label>
                <input type="email" class="form-control" [(ngModel)]="updatedStaff.email" name="email" required />
              </div>
              <div class="mb-2">
                <label>Age</label>
                <input type="number" class="form-control" [(ngModel)]="updatedStaff.age" name="age" required />
              </div>
              <div class="mb-2">
                <label>Gender</label>
                <select class="form-select" [(ngModel)]="updatedStaff.gender" name="gender" required>
                  <option value="">-- Select Gender --</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
              </div>
              <div class="mb-2">
                <label>Phone Number</label>
                <input type="text" class="form-control" [(ngModel)]="updatedStaff.phoneNumber" name="phoneNumber"
                  required />
              </div>
              <div class="mb-2">
                <label>Subject Name</label>
                <select class="form-select" [(ngModel)]="updatedStaff.subjectNme" name="subjectNme">
                  <option value="">-- Select Subject --</option>
                  <option *ngFor="let subject of hodSubjects" [value]="subject.id">{{ subject.subjectName
                    }}</option>
                </select>
              </div>
              <div class="mb-2">
                <label>Course Name</label>
                <select class="form-select" [(ngModel)]="updatedStaff.courseName" name="courseName">
                  <option value="">-- Select Subject --</option>
                  <option *ngFor="let course of hodCourses" [value]="course.id">{{ course.courseName }}
                  </option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="submit">Update</button>
              <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div *ngIf="viewSection === 'hodStaff'">
      <h5 class="text-primary fw-bold mb-3">üë©‚Äçüè´ Staff Members</h5>
      <ng-container *ngIf="hodStaff?.length && hodStaff.length > 0; else noStaff">
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead class="table-secondary">
              <tr>
                <th>#</th>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Gender</th>
                <th>Phone</th>
                <th>Subject</th>
                <th>Course</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let staff of hodStaff; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{staff.id}}</td>
                <td>{{ staff.name }}</td>
                <td>{{ staff.email }}</td>
                <td>{{ staff.gender }}</td>
                <td>{{ staff.phoneNumber }}</td>
                <td>{{ staff.subjectNme }}</td>
                <td>{{ staff.courseName }}</td>
                <td>
                  <button class="btn btn-success btn-sm me-2" (click)="openUpdateStaffModal(staff)">Edit</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>

      <ng-template #noStaff>
        <p class="text-muted">No staff members found.</p>
      </ng-template>
    </div>

    <!-- Staff View -->
    <div *ngIf="hasRole('ROLE_STAFF')" class="student-dashboard py-5">
      <h2 class="mb-4 text-center text-white bg-primary rounded p-3 mt-4"
        style="background-color: #41B3A2; margin: 20%;">
        Welcome {{ username }} to Dashboard</h2>

      <!-- Common Table -->
      <div *ngIf="viewSection === 'pending'">
        <h5 class="text-primary fw-bold mb-3">üìå Pending Course Requests</h5>
        <ng-container *ngIf="pendingStudents?.length && pendingStudents.length > 0; else noPending">
          <table class="table table-bordered table-striped">
            <thead class="table-info">
              <tr>
                <th>#</th>
                <th>Student</th>
                <th>Department</th>
                <th>Email</th>
                <th>Course</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of pendingStudents; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.studentName }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.courseName }}</td>
                <td>{{student.status}}</td>
                <td>
                  <button class="btn btn-success btn-sm me-2"
                    (click)="confirmStudentAction(student.id, 'approveByStaff')">Approve</button>
                  <button class="btn btn-danger btn-sm"
                    (click)="confirmStudentAction(student.id, 'rejectByStaff')">Reject</button>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noPending>
          <p>No pending students found.</p>
        </ng-template>
      </div>

      <!-- Approved Students -->
      <div *ngIf="viewSection === 'approved'">
        <h5 class="text-success fw-bold mb-3">‚úÖ Approved Students</h5>
        <ng-container *ngIf="approvedStudents?.length && approvedStudents.length > 0; else noApproved">
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Course Name</th>
                <th>Department</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of approvedStudents let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.studentName }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.courseName }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.status }}</td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noApproved>
          <p>No approved students found.</p>
        </ng-template>
      </div>

      <!-- Rejected Students -->
      <div *ngIf="viewSection === 'rejected'">
        <h5 class="text-danger fw-bold mb-3">Rejected Students</h5>
        <ng-container *ngIf="rejectedStudents?.length && rejectedStudents.length > 0; else noRejected">

          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Course Name</th>
                <th>Department</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of rejectedStudents; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.studentName }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.courseName }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.status }}</td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noRejected>
          <p>No rejected students found.</p>
        </ng-template>
      </div>
      <div *ngIf="viewSection === 'subjectStudents'">
        <h5 class="text-info fw-bold mb-3">üìö Students Under Your Subjects</h5>
        <ng-container *ngIf="subjectStudents?.length && subjectStudents.length > 0; else noSubjectStudents">
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Department</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of subjectStudents; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.name }}</td>
                <td>{{ student.email }}</td>
                <td>{{student.departmentName}}</td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noSubjectStudents>
          <p>No students found under your subjects.</p>
        </ng-template>
      </div>
      <div *ngIf="viewSection === 'staffInfo'">
        <h5 class="text-dark fw-bold mb-3">üë®‚Äçüè´ My Profile</h5>
        <div class="list-group ">
          <p><strong>Name:</strong> {{ staffInfo.name }}</p>
          <p><strong>Age:</strong> {{ staffInfo.age }}</p>
          <p><strong>Email:</strong> {{ staffInfo.email }}</p>
          <p><strong>Department:</strong> {{ staffInfo.departmentName }}</p>
          <p><strong>Gender:</strong> {{ staffInfo.gender }}</p>
          <p><strong>Phone Number:</strong> {{ staffInfo.phoneNumber }}</p>
          <p><strong>Subject Name:</strong> {{ staffInfo.subjectName?.name || "Not Assigned" }}</p>
          <p><strong>Department Name:</strong> {{ staffInfo.departmentName }}</p>
          <p><strong>Course Name:</strong> {{ staffInfo.courseName }}</p>
        </div>
      </div>
      <!-- All Studens-->
      <div *ngIf="viewSection === 'allStudents'">
        <h5 class="text-secondary fw-bold mb-3">üìã All Course Request Students</h5>
        <ng-container *ngIf="allStudents?.length && allStudents.length > 0; else noStudents">
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>S.NO</th>
                <th>Name</th>
                <th>Email</th>
                <th>Department</th>
                <th>Course</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of allStudents; let i = index">
                <td>{{i+1}}</td>
                <td>{{ student.studentName}}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.courseName }}</td>
                <td>{{ student.status }}</td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noStudents>
          <p>No students found under your subjects.</p>
        </ng-template>
      </div>
    </div>

    <!-- Student View -->
    <div *ngIf="hasRole('ROLE_STUDENT')" class="student-dashboard py-5">
      <h2 class="mb-4 text-center text-wieght  rounded p-3 mt-4" style="background-color: #6528F7; margin: 20%;">üéì
        Student Dashboard
      </h2>

      <!-- Profile Section -->
      <div *ngIf="viewSection === 'profile'" class="card p-3 mb-4">
        <h5 class="mb-3" style="color: #41B3A2;">üë§ Profile</h5>
        <ng-container *ngIf="studentProfile; else loadingProfile">
          <ul class="list-group">
            <div class="col-md-4 text-center mb-3">
              <strong>Profile Image:</strong><br />
              <img
                [src]="studentProfile?.profileImagePath ? 'http://localhost:8080' + studentProfile.profileImagePath : 'http://localhost:8080' + '/uploads/assets/default-profile.png'"
                class="img-thumbnail rounded-circle mt-2 profile-thumbnail" alt="Profile Image" />
            </div>
            <li class="list-group-item"><strong>Name:</strong> {{ studentProfile?.name }}</li>
            <li class="list-group-item"><strong>Email:</strong> {{ studentProfile?.email }}</li>
            <li class="list-group-item"><strong>Phone:</strong> {{ studentProfile?.phoneNumber }}</li>
            <li class="list-group-item"><strong>Department:</strong> {{ studentProfile?.departmentName }}
            </li>
            <li class="list-group-item"><strong>Course Name:</strong> {{ studentProfile?.courseName }}
            </li>
            <li class="list-group-item"><strong>Subject Name:</strong> {{ studentProfile?.subjectName }}
            </li>
          </ul>
        </ng-container>
        <ng-template #loadingProfile>
          <p>Loading profile...</p>
        </ng-template>
      </div>

      <!-- Courses Section -->
      <div *ngIf="viewSection === 'courses'" class="card p-3 mb-4">
        <h5 class="mb-3" style="color: #6a1b9a;">üìö Available Courses</h5>
        <ng-container *ngIf="courseList?.length && courseList.length > 0; else noCourses">
          <ul class="list-group">
            <li *ngFor="let course of courseList; let i = index"
              class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ i + 1 }}:</strong> {{ course.courseName }}<br />
                <small>üë®‚Äçüè´ {{ course.staffName || 'Staff Not Assigned' }}</small>
              </div>
              <button class="btn btn-warning " (click)="confirmCourseEnroll(course.id)"><svg
                  xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-pin-angle-fill fs-2" viewBox="0 0 16 16">
                  <path
                    d="M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a6 6 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707s.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a6 6 0 0 1 1.013.16l3.134-3.133a3 3 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146" />
                </svg>Enroll</button>
            </li>
          </ul>
        </ng-container>
        <ng-template #noCourses>
          <p>No courses available at the moment.</p>
        </ng-template>
      </div>

      <!-- Department Info Section -->
      <div *ngIf="viewSection === 'department'" class="card p-3 mb-4">
        <h5 class="mb-3" style="color: #6a1b9a;">üè´ Department Information</h5>

        <ng-container *ngIf="departmentInfo; else loadingDept">
          <p><strong>Department Name:</strong> {{ departmentInfo?.departmentName }}</p>
          <p><strong>HOD:</strong> {{ departmentInfo?.hodName }} ({{ departmentInfo?.hodEmail }})</p>
          <p><strong>Staff Members:</strong></p>
          <ul class="list-group">
            <ng-container *ngIf="departmentInfo.staffNames?.length > 0; else noStaff">
              <li *ngFor="let staff of departmentInfo.staffNames; let i = index" class="list-group-item">
                {{ i + 1 }}. {{ staff }}
              </li>
            </ng-container>
            <ng-template #noStaff>
              <li class="list-group-item text-muted">Not Assigned</li>
            </ng-template>
          </ul>
        </ng-container>
        <ng-template #loadingDept>
          <p>No department info available...</p>
        </ng-template>
      </div>
    </div>
  </div>
</body>