<app-navbar [sidebarCollapsed]="sidebarCollapsed" (toggleSidebarEvent)="toggleSidebar()">
</app-navbar>
<app-toast></app-toast>
<app-sidebar [collapsed]="sidebarCollapsed" [userRoles]="userRoles" [activeSection]="viewSection ?? ''"
  (sectionChange)="toggleSection($event)">
</app-sidebar>


<body>
  <div class="main-content" [class.collapsed]="sidebarCollapsed">
    <!-- Admin Dashboard Views -->
    <div *ngIf="hasRole('ROLE_ADMIN')" class="hod-dashboard py-5">
      <div class="container mt-4" *ngIf="viewSection === 'dashboard'">
        <div class="row row-cols-1 mt-4 row-cols-md-3 g-4 justify-content-center">

          <h2 class="mb-4 text-center text-white w-75 rounded p-4 mt-4"
            style="background-color: #41B3A2; margin: 250px;">
            Welcome to üßë‚Äçüíº Admin Dashboard
          </h2>
          <!-- Total Students -->
          <div class="col">
            <div class="card text-bg-primary mb-3 shadow" style="min-height: 12rem;">
              <div class="card-header">
                <i class="bi bi-person-bounding-box me-2"></i> Students
              </div>
              <div class="card-body">
                <h5 class="card-title">Total Students</h5>
                <p class="card-text fs-4">{{ allStudents.length || 0 }}</p>
              </div>
            </div>
          </div>

          <!-- Total Users -->
          <div class="col">
            <div class="card text-bg-success mb-3 shadow" style="min-height: 12rem;">
              <div class="card-header">
                <i class="bi bi-person-lines-fill me-2"></i> Users
              </div>
              <div class="card-body">
                <h5 class="card-title">Total Users</h5>
                <p class="card-text fs-4">{{ allUsers.length || 0 }}</p>
              </div>
            </div>
          </div>

          <!-- Staff & HOD -->
          <div class="col">
            <div class="card text-bg-info mb-3 shadow" style="min-height: 12rem;">
              <div class="card-header">
                <i class="bi bi-people-fill me-2"></i> Staff & HOD
              </div>
              <div class="card-body">
                <h5 class="card-title">Total Staff & HOD</h5>
                <p class="card-text fs-4">{{ UsersProfile.length || 0 }}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="card mt-2 w-75 items-center mx-auto">
          <div class="card-body">
            <h5 class="card-title text-primary">üìä Department-wise Student Count</h5>
            <canvas baseChart [data]="barChartData" [options]="barChartOptions" [type]="'bar'">
            </canvas>
          </div>
        </div>
      </div>


      <!-- Create Staff / HOD Modal -->
      <div class="modal fade" id="createUserModal" tabindex="-1" aria-labelledby="createUserModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header bg-success text-white">
              <h5 class="modal-title" id="createUserModalLabel">‚ûï Create User (HOD / Staff / Admin)</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body: Form -->
            <div class="modal-body">
              <form (ngSubmit)="submitCreateUser()" #createUserForm="ngForm">
                <div class="row g-3">

                  <div class="col-md-6">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" [(ngModel)]="newUserPro.name" name="name" required>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" [(ngModel)]="newUserPro.email" name="email" required>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">Phone Number</label>
                    <input type="text" class="form-control" [(ngModel)]="newUserPro.phoneNumber" name="phoneNumber"
                      required>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">Gender</label>
                    <select class="form-select" name="gender" [(ngModel)]="newUserPro.gender" required>
                      <option value="">-- Select Gender --</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                    </select>
                  </div>


                  <div class="col-md-6">
                    <label class="form-label">Role</label>
                    <select class="form-select" name="role" [(ngModel)]="newUserPro.role" required>
                      <option value="">-- Select Role --</option>
                      <option value="HOD">HOD</option>
                      <option value="STAFF">Staff</option>
                      <option value="ADMIN">Admin</option>
                    </select>
                  </div>

                  <div class="col-md-12" *ngIf="newUserPro.role === 'HOD' || newUserPro.role === 'STAFF'">
                    <label class="form-label">Department</label>
                    <select class="form-select" name="departmentId" [(ngModel)]="newUserPro.departmentId" required>
                      <option value="">-- Select Department --</option>
                      <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.departmentName }}</option>
                    </select>
                  </div>

                </div>

                <div class="text-end mt-4">
                  <button type="submit" class="btn btn-success" [disabled]="createUserForm.invalid">
                    <i class="bi bi-check-circle me-1"></i> Create User
                  </button>
                </div>
              </form>
            </div>

          </div>
        </div>
      </div>


      <!-- Create User -->

      <div *ngIf="viewSection === 'adminCreateUser'" class="card p-3 mb-4">
        <h5 class="text-primary">‚ûï Create User</h5>
        <form (ngSubmit)="submitCreateUser()">
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" [(ngModel)]="newUser.username" name="username" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" [(ngModel)]="newUser.password" name="password" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Role Name</label>
            <select name="roleid" class="form-select" [(ngModel)]="newUser.roleId" name="editRole" required>
              <option value="">-- Select Role --</option>
              <option *ngFor="let role of roles" [value]="role.id">{{ role.role?.startsWith('ROLE_') ?
                role.role.substring(5) : role.role || 'Unknown' }}</option>
            </select>
          </div>
          <button type="submit" class="btn btn-info">Create User</button>
        </form>
      </div>

      <!-- Edit User Modal -->
      <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-info text-white">
              <h5 class="modal-title icon-edit" id="editUserModalLabel">Edit User</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form (ngSubmit)="submitUserUpdate()">
              <div class="modal-body">
                <div class="mb-3">
                  <label class="form-label">Username</label>
                  <input type="text" class="form-control" [(ngModel)]="editUser.username" name="editUsername" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Password</label>
                  <input type="password" class="form-control" [(ngModel)]="editUser.password" name="editPassword"
                    required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Role Name</label>
                  <select name="roleid" class="form-select" [(ngModel)]="editUser.roleId" name="editRole" required>
                    <option value="">-- Select Role --</option>
                    <option *ngFor="let role of roles" [value]="role.id">{{ role.role?.startsWith('ROLE_') ?
                      role.role.substring(5) : role.role || 'Unknown' }}</option>
                  </select>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Update User</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Assign Roles -->
      <div *ngIf="viewSection === 'adminAssignRole'" class="card p-3 mb-4">
        <h5 class="text-primary">üîê Assign Role and Auth to Users</h5>
        <form (ngSubmit)="submitAssignRole()">
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" [(ngModel)]="roleAssign.username" name="roleUsername" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Target ID (Staff/HOD)</label>
            <input type="number" class="form-control" [(ngModel)]="roleAssign.userId" name="targetId" required>
          </div>
          <button type="submit" class="btn btn-primary">Assign Role</button>
        </form>
      </div>
      <div *ngIf="viewSection === 'adminAssignRole'" class="card p-3 mb-4">
        <h5 class="text-primary">üîê Assign Role and Auth to Student</h5>
        <form (ngSubmit)="submitAssignStud()">
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" [(ngModel)]="roleAssignStud.username" name="roleUsername" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Student ID</label>
            <input type="number" class="form-control" [(ngModel)]="roleAssignStud.studId" name="targetId" required>
          </div>
          <button type="submit" class="btn btn-primary">Assign Role</button>
        </form>
      </div>


      <!-- Assign Subject to Department Students -->
      <div *ngIf="viewSection === 'adminAssignSubject'" class="card p-3 mb-4">
        <h5 class="text-primary">üìò Assign Subject to Student By Department</h5>
        <form (ngSubmit)="submitAssignSubject()">
          <div class="col-md-6 mb-3">
            <label class="form-label">Department Name</label>
            <select class="form-select" [(ngModel)]="assignSubject.departmentId" name="departmentName">
              <option value="">-- Select Department --</option>
              <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.departmentName }}</option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Subject Name</label>
            <select class="form-select" [(ngModel)]="assignSubject.subjectId" name="subjectName">
              <option value="">-- Select Subject --</option>
              <option *ngFor="let subject of subjects" [value]="subject.id">{{ subject.subjectName }}</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Assign Subject</button>
        </form>
      </div>

      <!-- All Users -->
      <div *ngIf="viewSection === 'adminAllUsers'">
        <h5 class="text-primary fw-bold">üë• All Users Auth</h5>
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <th>S.NO</th>
              <th>Username</th>
              <th>Role</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of allUsers; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ user.username }}</td>
              <td>{{ user.role?.startsWith('ROLE_') ? user.role.substring(5) : user.role || 'Unknown' }}</td>
              <td>
                <button class="btn btn-outline-warning ms-3" (click)="openEditUserModel(user)"><i
                    class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-outline-danger ms-3" (click)="deleteUserAuthSwal(user.id)"><i
                    class="bi bi-trash"></i>
                </button>
              </td>

            </tr>
          </tbody>
        </table>
      </div>

      <!-- All Staff & Hod -->
      <div *ngIf="viewSection === 'adminAllStaffHod'" class="px-2 py-3">
        <!-- Header + Add Button -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="text-primary fw-bold mb-0">üéì All Staff & HOD</h5>
          <button class="btn btn-success" (click)="submitCreateUserPro()">
            <i class="bi bi-person-plus-fill me-1"></i> Add User
          </button>
        </div>

        <!-- Filters -->
        <div class="row g-2 mb-3">
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder="üîç Search by name or username" [(ngModel)]="searchText"
              (input)="onFilterChange()" />
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterRole" (change)="onFilterChange()">
              <option value="">All Roles</option>
              <option value="ROLE_ADMIN">ADMIN</option>
              <option value="ROLE_STAFF">STAFF</option>
              <option value="ROLE_HOD">HOD</option>
            </select>
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterDepartment" (change)="onFilterChange()">
              <option [ngValue]="null">All Departments</option>
              <option *ngFor="let dept of departments" [ngValue]="dept.id">{{ dept.departmentName }}</option>
            </select>
          </div>
        </div>

        <!-- Table -->
        <table class="table table-hover table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Role</th>
              <th>Username</th>
              <th>Phone</th>
              <th>Department</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of UsersProfile; let i = index">
              <td>{{ i + 1 + (page * size) }}</td>
              <td>{{ user.name }}</td>
              <td><span class="badge bg-info">{{ user.role?.startsWith('ROLE_') ? user.role?.substring(5) : user.role
                  }}</span></td>
              <td>{{ user.username }}</td>
              <td>{{ user.phoneNumber || 'N/A' }}</td>
              <td>{{ user.departmentName || 'N/A' }}</td>
              <td>
                <button class="btn btn-outline-info btn-sm me-1" (click)="viewUsersProfile(user)">
                  <i class="bi bi-eye-fill"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm" (click)="deleteUserSwal(user.id)">
                  <i class="bi bi-trash3-fill"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="UsersProfile.length === 0">
              <td colspan="7" class="text-muted">No users found.</td>
            </tr>
          </tbody>
        </table>
        <!-- Pagination Controls -->
        <nav *ngIf="totalPages > 1">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="page === 0">
              <a class="page-link" (click)="onPageChange(page - 1)">Previous</a>
            </li>
            <li class="page-item disabled">
              <span class="page-link">Page {{ page + 1 }} of {{ totalPages }}</span>
            </li>
            <li class="page-item" [class.disabled]="page + 1 >= totalPages">
              <a class="page-link" (click)="onPageChange(page + 1)">Next</a>
            </li>
          </ul>
        </nav>

        <!-- View User Profile Modal -->
        <div class="modal fade" id="viewUserProModal" tabindex="-1" aria-labelledby="viewUserProModal"
          aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">

              <!-- Modal Header -->
              <div class="modal-header bg-info text-white">
                <h5 class="modal-title">üéì Staff / HOD Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

              <!-- Modal Body -->
              <div class="modal-body">
                <div class="container-fluid">

                  <!-- Profile Image and Basic -->
                  <div class="row mb-3">
                    <div class="col text-center">
                      <img [src]="'http://localhost:8080/uploads/assets/default-profile.png'" alt="Profile"
                        class="rounded-circle shadow" width="100" height="100">
                      <h5 class="mt-2 text-dark">{{ selectedUserProfile?.name }}</h5>
                      <span class="badge bg-primary">{{ selectedUserProfile?.username }}</span>
                    </div>
                  </div>

                  <!-- Info Cards -->
                  <div class="row g-4">

                    <!-- Contact Info -->
                    <div class="col-md-6">
                      <div class="card info-card border-0 shadow-sm violet-card text-white">
                        <div class="card-body">
                          <h5 class="card-title mb-3"><i class="bi bi-envelope-fill me-2"></i>Contact Info</h5>
                          <p class="mb-2">
                            <i class="bi bi-envelope-open me-2"></i><strong>Email:</strong>
                            {{ selectedUserProfile?.email }}
                          </p>
                          <p>
                            <i class="bi bi-telephone-fill me-2"></i><strong>Phone:</strong>
                            {{ selectedUserProfile?.phoneNumber }}
                          </p>
                        </div>
                      </div>
                    </div>

                    <!-- Personal Info -->
                    <div class="col-md-6">
                      <div class="card info-card border-0 shadow-sm violet-card text-white">
                        <div class="card-body">
                          <h5 class="card-title mb-3"><i class="bi bi-person-fill me-2"></i>Personal Info</h5>
                          <p class="mb-2">
                            <i class="bi bi-gender-ambiguous me-2"></i><strong>Gender:</strong>
                            {{ selectedUserProfile?.gender }}
                          </p>
                          <p>
                            <i class="bi bi-calendar-fill me-2"></i><strong>Age:</strong>
                            {{ selectedUserProfile?.age }}
                          </p>
                        </div>
                      </div>
                    </div>

                    <!-- Academic Info -->
                    <div class="col-md-12">
                      <div class="card info-card border-0 shadow-sm violet-card text-white">
                        <div class="card-body">
                          <h5 class="card-title mb-3"><i class="bi bi-journal-text me-2"></i>Academic Info</h5>
                          <div class="row">
                            <div class="col-md-4 mb-2">
                              <i class="bi bi-book me-2"></i><strong>Course:</strong>
                              {{ selectedUserProfile?.courseName || 'Not Assigned' }}
                            </div>
                            <div class="col-md-4 mb-2">
                              <i class="bi bi-easel2-fill me-2"></i><strong>Subject:</strong>
                              {{ selectedUserProfile?.subjectName || 'Not Assigned' }}
                            </div>
                            <div class="col-md-4 mb-2">
                              <i class="bi bi-building me-2"></i><strong>Department:</strong>
                              {{ selectedUserProfile?.departmentName || 'Not Assigned' }}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div> <!-- row -->

                </div> <!-- container-fluid -->
              </div> <!-- modal-body -->

              <!-- Modal Footer -->
              <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>

            </div>
          </div>
        </div>

        <!-- Full View of Staff and Admin-->
        <div class="modal fade" id="viewUserProModal" tabindex="-1" aria-labelledby="viewUserProModal"
          aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="viewUserProModal">üéì Staff / HOD Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <!-- All Students -->
      <div *ngIf="viewSection === 'adminAllStudents'">
        <h5 class="text-primary fw-bold">üéì All Students</h5>
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <th>S.NO</th>
              <th>Name</th>
              <th>Username</th>
              <th>Phone</th>
              <th>Department</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of allStudents; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ student.name }}</td>
              <td>{{ student.username }}</td>
              <td>{{ student.phoneNumber }}</td>
              <td>{{ student.departmentName }}</td>
              <td>{{ student.status }}</td>
              <td class=" gap-2 gap-md-3 d-flex justify-content-center">
                <button class="btn btn-outline-warning" (click)="openEditStudentModal(student)"><i
                    class="bi bi-pencil-square" title="Edit"></i></button>
                <button class="btn btn-outline-info" (click)="viewStudentProfile(student)">
                  <i class="bi bi-eye" title="View"></i>
                </button>
                <button class="btn btn-outline-danger" (click)="deleteStudentSwal(student.id)">
                  <i class="bi bi-trash " title="Delete"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- Update Student -->
      <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <form (ngSubmit)="AdminsubmitUpdateStudent()">
              <div class="modal-header">
                <h5 class="modal-title" id="editStudentModalLabel">‚úç Update Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.name" name="studentName"
                      required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Age</label>
                    <input type="number" class="form-control" [(ngModel)]="studentEdit.age" name="studentAge" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Gender</label>
                    <select class="form-select" [(ngModel)]="studentEdit.gender" name="studentGender">
                      <option value="">-- Select Gender --</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" [(ngModel)]="studentEdit.email" name="studentEmail"
                      required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" [(ngModel)]="studentEdit.phoneNumber" name="studentPhone" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Department</label>
                    <select class="form-select" [(ngModel)]="studentEdit.departmentId" name="studentDepartment">
                      <option value="">-- Select Department --</option>
                      <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.departmentName }}</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Course Name</label>
                    <select class="form-select" [(ngModel)]="studentEdit.courseId" name="studentCourse">
                      <option value="">-- Select Course --</option>
                      <option *ngFor="let course of hodCourses" [value]="course.id">{{ course.courseName }}</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Subject</label>
                    <select class="form-select" [(ngModel)]="studentEdit.subjectId" name="studentSubject">
                      <option value="">-- Select Subject --</option>
                      <option *ngFor="let subject of subjects" [value]="subject.id">{{ subject.subjectName }}</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Status</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.active" name="studentStatus" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Course Status</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.courseStatus"
                      name="studentCourseStatus" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Profile Image</label>
                    <input type="file" class="form-control" (change)="onProfileImageSelected($event)">
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Marksheet Image</label>
                    <input type="file" class="form-control" (change)="onMarksheetImageSelected($event)">
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- View Student Profile Modal -->

    <div class="modal fade" id="viewStudentModal" tabindex="-1" aria-labelledby="viewStudentModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header bg-info text-white">
            <h5 class="modal-title" id="viewStudentModalLabel">üéì Student Full Profile</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <!-- Top: Profile + Basic Info -->
            <div class="row align-items-start">
              <div class="col-md-4 text-center mb-3">
                <strong>Profile Image:</strong><br />
                <img
                  [src]="selectedStudent?.profileImagePath ? 'http://localhost:8080' + selectedStudent.profileImagePath :'http://localhost:8080' + '/uploads/assets/default-profile.png'"
                  class="img-thumbnail rounded-circle mt-2 profile-thumbnail" alt="Profile Image" />
              </div>
              <div class="col-md-8">
                <div class="row">
                  <div class="col-6 mb-2"><strong>Name:</strong> {{ selectedStudent?.name }}</div>
                  <div class="col-6 mb-2"><strong>Student ID:</strong> {{ selectedStudent?.id }}</div>
                  <div class="col-6 mb-2"><strong>Email:</strong> {{ selectedStudent?.email }}</div>
                  <div class="col-6 mb-2"><strong>Username:</strong> {{ selectedStudent?.username }}</div>
                  <div class="col-6 mb-2"><strong>Phone:</strong> {{ selectedStudent?.phoneNumber }}</div>
                  <div class="col-6 mb-2"><strong>Gender:</strong> {{ selectedStudent?.gender }}</div>
                  <div class="col-6 mb-2"><strong>Age:</strong> {{ selectedStudent?.age }}</div>
                  <div class="col-6 mb-2"><strong>Status:</strong> {{ selectedStudent?.status }}</div>
                  <div class="col-6 mb-2"><strong>Course Status:</strong> {{ selectedStudent?.courseStatus }}</div>
                  <div class="col-6 mb-2"><strong>Course Name:</strong> {{ selectedStudent?.courseName }}</div>
                  <div class="col-6 mb-2"><strong>Subject Name:</strong> {{ selectedStudent?.subjectName }}</div>
                  <div class="col-6 mb-2"><strong>Department:</strong> {{ selectedStudent?.departmentName }}</div>
                </div>
              </div>
            </div>

            <!-- Full Marksheet Preview -->
            <div class="row mt-4">
              <div class="col-12 text-center">
                <strong>Marksheet Image:</strong><br />
                <img
                  [src]="selectedStudent?.marksheetImagePath ? 'http://localhost:8080' + selectedStudent.marksheetImagePath : 'http://localhost:8080' + '/uploads/assets/default-marksheet.png'"
                  class="img-fluid rounded shadow mt-2" style="max-height: 500px;" alt="Marksheet Image" />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Admin View -->


    <!-- HOD View Section -->
    <div *ngIf="hasRole('ROLE_HOD')" class="hod-dashboard py-5">
      <h2 class="mb-4 text-center text-white  rounded p-3 mt-4" style="background-color: #41B3A2; margin: 250px;">
        Welcome {{ username }} to üßë‚Äçüíº HOD Dashboard
      </h2>

      <!-- Requested Students Table -->
      <div *ngIf="viewSection === 'hodRequested'">
        <h5 class="text-primary fw-bold mb-3">üìå Requested Students</h5>
        <ng-container *ngIf="hodRequested?.length && hodRequested.length > 0; else noRequested">
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Department</th>
                <th>Status </th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of hodRequested; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.name }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.phoneNumber }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.status }}</td>
                <td>
                  <button class="btn btn-success btn-sm me-2"
                    (click)="confirmStudentAction(student.id, 'approve')">Approve</button>
                  <button class="btn btn-danger btn-sm"
                    (click)="confirmStudentAction(student.id, 'reject')">Reject</button>
                </td>

              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noRequested>
          <p>No requested students found.</p>
        </ng-template>
      </div>


      <!--  Approved Students -->
      <!-- Update Student Modal -->
      <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <form (ngSubmit)="submitUpdateStudent()">
              <div class="modal-header">
                <h5 class="modal-title" id="editStudentModalLabel">‚úç Update Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" name="studentName" required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Age</label>
                    <input type="number" class="form-control" [(ngModel)]="studentEdit.age" name="studentAge" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Gender</label>
                    <select class="form-select" [(ngModel)]="studentEdit.gender" name="studentGender">
                      <option value="">-- Select Gender --</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" [(ngModel)]="studentEdit.email" name="studentEmail"
                      required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Phone Number</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.phoneNumber" name="studentPhone" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Profile Image</label>
                    <input type="file" class="form-control" (change)="onProfileImageSelected($event)">
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Marksheet Image</label>
                    <input type="file" class="form-control" (change)="onMarksheetImageSelected($event)">
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="viewSection === 'hodApproved'">
      <h5 class="text-success fw-bold mb-3"> Approved Students</h5>
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="table-success">
            <tr>
              <th>#</th>
              <th>ID</th>
              <th>Name</th>
              <th>Age</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Course</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of hodApproved; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{student.id}}</td>
              <td>{{ student.name }}</td>
              <td>{{ student.age }}</td>
              <td>{{ student.email }}</td>
              <td>{{ student.phoneNumber }}</td>
              <td>{{ student.courseName }}</td>
              <td>
                <button class="btn btn-success btn-sm me-2" (click)="openEditStudentModal(student)">
                  Edit
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ‚ùå Rejected Students -->
    <div *ngIf="viewSection === 'hodRejected'">
      <h5 class="text-danger fw-bold mb-3">‚ùå Rejected Students</h5>
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="table-danger">
            <tr>
              <th>#</th>
              <th>ID</th>
              <th>Name</th>
              <th>Course</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of hodRejected; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ student.id }}</td>
              <td>{{ student.name }}</td>
              <td>{{ student.courseName }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div *ngIf="viewSection === 'hodCreateStaff'" class="card p-3 mb-4 rounded w-75 mx-auto">
      <h5 class="text-primary">‚ûï Add Staff</h5>
      <form (ngSubmit)="submitCreateStaff()" #staffForm="ngForm" novalidate>

        <div class="mb-3">
          <label class="form-label">Name</label>
          <input type="text" class="form-control" name="name" [(ngModel)]="newStaff.name" required>
          <div class="text-danger" *ngIf="staffForm.submitted && !newStaff.name">Name is required.</div>
        </div>

        <div class="mb-3">
          <label class="form-label">Age</label>
          <input type="number" class="form-control" name="age" [(ngModel)]="newStaff.age" min="18" required>
          <div class="text-danger" *ngIf="staffForm.submitted && (!newStaff.age || newStaff.age < 18)">
            Age must be 18 or older.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Gender</label>
          <select class="form-select" name="gender" [(ngModel)]="newStaff.gender" required>
            <option value="">-- Select Gender --</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>

          </select>
          <div class="text-danger" *ngIf="staffForm.submitted && !newStaff.gender">Gender is required.</div>
        </div>

        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" name="email" [(ngModel)]="newStaff.email" required email>
          <div class="text-danger" *ngIf="staffForm.submitted && !staffForm.controls['email']?.valid">
            Valid email is required.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Phone Number</label>
          <input type="text" class="form-control" name="phoneNumber" [(ngModel)]="newStaff.phoneNumber"
            pattern="^[0-9]{10}$" required>
          <div class="text-danger" *ngIf="staffForm.submitted && !staffForm.controls['phoneNumber']?.valid">
            Phone number must be 10 digits.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Subject</label>
          <select class="form-select" [(ngModel)]="newStaff.subjectId" name="subjectId" required>
            <option [ngValue]="null">-- Select Subject --</option>
            <option *ngFor="let subject of hodSubjects" [value]="subject.id">
              {{ subject.subjectName }}
            </option>
          </select>
        </div>


        <div class="mb-3">
          <label class="form-label">Course Name (optional)</label>
          <select class="form-select" [(ngModel)]="updatedStaff.courseName" name="courseName">
            <option value="">-- Select Subject --</option>
            <option *ngFor="let course of hodCourses" [value]="course.id">{{ course.courseName }}</option>
          </select>
        </div>

        <button type="submit" class="btn btn-success">Create Staff</button>
      </form>
    </div>

    <div *ngIf="viewSection === 'hodCreateSubject'" class="card p-3 mb-4">
      <h5 class="text-primary"> Add Subject</h5>
      <form (ngSubmit)="submitCreateSubject()">
        <div class="mb-3">
          <label class="form-label">Subject Name</label>
          <input type="text" class="form-control" [(ngModel)]="newSubjectName" name="subjectName" required>
        </div>
        <button type="submit" class="btn btn-primary">Create Subject</button>
      </form>
    </div>

    <div *ngIf="viewSection === 'hodCreateCourse'" class="card p-3 mb-4">
      <h5 class="text-primary"> Add Course</h5>
      <form (ngSubmit)="submitCreateCourse()">
        <div class="mb-3">
          <label class="form-label">Course Name</label>
          <input type="text" class="form-control" [(ngModel)]="newCourseName" name="courseName" required>
        </div>
        <button type="submit" class="btn btn-primary">Create Course</button>
      </form>
    </div>
    <!-- üìö All Subjects -->

    <!-- Subject Edit Modal -->
    <div class="modal fade" id="editSubjectModal" tabindex="-1" aria-labelledby="editSubjectLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form (ngSubmit)="UpdateHodSubject()">
            <div class="modal-header">
              <h5 class="modal-title" id="editSubjectLabel">Edit Subject</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <label class="form-label">New Subject Name</label>
              <input type="text" class="form-control" [(ngModel)]="updatedSubjectName" name="updatedSubjectName"
                required>
            </div>

            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Save</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div *ngIf="viewSection === 'hodSubjects'">
      <h5 class="text-info fw-bold mb-3">üìö All Subjects</h5>
      <ng-container *ngIf="hodSubjects?.length && hodSubjects.length > 0; else noSubjects">
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead class="table-info">
              <tr>
                <th>#</th>
                <th>ID</th>
                <th>Subject Name</th>
                <th>Department</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let subject of hodSubjects; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ subject.id }}</td>
                <td>{{ subject.subjectName }}</td>
                <td>{{ subject.departmentName }}</td>
                <td>
                  <button class="btn btn-success btn-sm me-2"
                    (click)="openSubjectEditModal(subject.id, subject.subjectName)">
                    Edit
                  </button>

                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>
      <ng-template #noSubjects>
        <p class="text-muted">No subjects found.</p>
      </ng-template>
    </div>

    <!-- üìò All Courses -->
    <div *ngIf="viewSection === 'hodCourses'">
      <h5 class="text-primary fw-bold mb-3">üìò All Courses</h5>
      <ng-container *ngIf="hodCourses?.length && hodCourses.length > 0; else noCourses">
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead class="table-primary">
              <tr>
                <th>#</th>
                <th>Course Name</th>
                <th>Staff Name</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let course of hodCourses; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ course.courseName }}</td>
                <td>{{ course.staffName }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>
      <ng-template #noCourses>
        <p class="text-muted">No courses found.</p>
      </ng-template>
    </div>

    <!-- üë©‚Äçüè´ All Staff -->
    <!-- Edit Staff Modal -->
    <div class="modal fade" id="editStaffModal" tabindex="-1" aria-labelledby="editStaffLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form (ngSubmit)="saveUpdatedStaff()">
            <div class="modal-header">
              <h5 class="modal-title" id="editStaffLabel">Edit Staff</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-2">
                <label>Name</label>
                <input type="text" class="form-control" [(ngModel)]="updatedStaff.name" name="name" required />
              </div>
              <div class="mb-2">
                <label>Email</label>
                <input type="email" class="form-control" [(ngModel)]="updatedStaff.email" name="email" required />
              </div>
              <div class="mb-2">
                <label>Age</label>
                <input type="number" class="form-control" [(ngModel)]="updatedStaff.age" name="age" required />
              </div>
              <div class="mb-2">
                <label>Gender</label>
                <select class="form-select" [(ngModel)]="updatedStaff.gender" name="gender" required>
                  <option value="">-- Select Gender --</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
              </div>
              <div class="mb-2">
                <label>Phone Number</label>
                <input type="text" class="form-control" [(ngModel)]="updatedStaff.phoneNumber" name="phoneNumber"
                  required />
              </div>
              <div class="mb-2">
                <label>Subject Name</label>
                <select class="form-select" [(ngModel)]="updatedStaff.subjectNme" name="subjectNme">
                  <option value="">-- Select Subject --</option>
                  <option *ngFor="let subject of hodSubjects" [value]="subject.id">{{ subject.subjectName }}</option>
                </select>
              </div>
              <div class="mb-2">
                <label>Course Name</label>
                <select class="form-select" [(ngModel)]="updatedStaff.courseName" name="courseName">
                  <option value="">-- Select Subject --</option>
                  <option *ngFor="let course of hodCourses" [value]="course.id">{{ course.courseName }}</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="submit">Update</button>
              <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div *ngIf="viewSection === 'hodStaff'">
      <h5 class="text-primary fw-bold mb-3">üë©‚Äçüè´ Staff Members</h5>
      <ng-container *ngIf="hodStaff?.length && hodStaff.length > 0; else noStaff">
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead class="table-secondary">
              <tr>
                <th>#</th>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Gender</th>
                <th>Phone</th>
                <th>Subject</th>
                <th>Course</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let staff of hodStaff; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{staff.id}}</td>
                <td>{{ staff.name }}</td>
                <td>{{ staff.email }}</td>
                <td>{{ staff.gender }}</td>
                <td>{{ staff.phoneNumber }}</td>
                <td>{{ staff.subjectNme }}</td>
                <td>{{ staff.courseName }}</td>
                <td>
                  <button class="btn btn-success btn-sm me-2" (click)="openUpdateStaffModal(staff)">Edit</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>

      <ng-template #noStaff>
        <p class="text-muted">No staff members found.</p>
      </ng-template>
    </div>

    <!-- Staff View -->
    <div *ngIf="hasRole('ROLE_STAFF')" class="student-dashboard py-5">
      <h2 class="mb-4 text-center text-white bg-primary rounded p-3 mt-4"
        style="background-color: #41B3A2; margin: 20%;">
        Welcome {{ username }} to Dashboard</h2>

      <!-- Common Table -->
      <div *ngIf="viewSection === 'pending'">
        <h5 class="text-primary fw-bold mb-3">üìå Pending Course Requests</h5>
        <ng-container *ngIf="pendingStudents?.length && pendingStudents.length > 0; else noPending">
          <table class="table table-bordered table-striped">
            <thead class="table-info">
              <tr>
                <th>#</th>
                <th>Student</th>
                <th>Department</th>
                <th>Email</th>
                <th>Course</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of pendingStudents; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.studentName }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.courseName }}</td>
                <td>{{student.status}}</td>
                <td>
                  <button class="btn btn-success btn-sm me-2"
                    (click)="confirmStudentAction(student.id, 'approveByStaff')">Approve</button>
                  <button class="btn btn-danger btn-sm"
                    (click)="confirmStudentAction(student.id, 'rejectByStaff')">Reject</button>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noPending>
          <p>No pending students found.</p>
        </ng-template>
      </div>

      <!-- Approved Students -->
      <div *ngIf="viewSection === 'approved'">
        <h5 class="text-success fw-bold mb-3">‚úÖ Approved Students</h5>
        <ng-container *ngIf="approvedStudents?.length && approvedStudents.length > 0; else noApproved">
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Course Name</th>
                <th>Department</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of approvedStudents let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.studentName }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.courseName }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.status }}</td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noApproved>
          <p>No approved students found.</p>
        </ng-template>
      </div>

      <!-- Rejected Students -->
      <div *ngIf="viewSection === 'rejected'">
        <h5 class="text-danger fw-bold mb-3">Rejected Students</h5>
        <ng-container *ngIf="rejectedStudents?.length && rejectedStudents.length > 0; else noRejected">

          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Course Name</th>
                <th>Department</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of rejectedStudents; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.studentName }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.courseName }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.status }}</td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noRejected>
          <p>No rejected students found.</p>
        </ng-template>
      </div>
      <div *ngIf="viewSection === 'subjectStudents'">
        <h5 class="text-info fw-bold mb-3">üìö Students Under Your Subjects</h5>
        <ng-container *ngIf="subjectStudents?.length && subjectStudents.length > 0; else noSubjectStudents">
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Department</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of subjectStudents; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.name }}</td>
                <td>{{ student.email }}</td>
                <td>{{student.departmentName}}</td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noSubjectStudents>
          <p>No students found under your subjects.</p>
        </ng-template>
      </div>
      <div *ngIf="viewSection === 'staffInfo'">
        <h5 class="text-dark fw-bold mb-3">üë®‚Äçüè´ My Profile</h5>
        <div class="list-group ">
          <p><strong>Name:</strong> {{ staffInfo.name }}</p>
          <p><strong>Age:</strong> {{ staffInfo.age }}</p>
          <p><strong>Email:</strong> {{ staffInfo.email }}</p>
          <p><strong>Department:</strong> {{ staffInfo.departmentName }}</p>
          <p><strong>Gender:</strong> {{ staffInfo.gender }}</p>
          <p><strong>Phone Number:</strong> {{ staffInfo.phoneNumber }}</p>
          <p><strong>Subject Name:</strong> {{ staffInfo.subjectName?.name || "Not Assigned" }}</p>
          <p><strong>Department Name:</strong> {{ staffInfo.departmentName }}</p>
          <p><strong>Course Name:</strong> {{ staffInfo.courseName }}</p>
        </div>
      </div>
      <!-- All Studens-->
      <div *ngIf="viewSection === 'allStudents'">
        <h5 class="text-secondary fw-bold mb-3">üìã All Course Request Students</h5>
        <ng-container *ngIf="allStudents?.length && allStudents.length > 0; else noStudents">
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>S.NO</th>
                <th>Name</th>
                <th>Email</th>
                <th>Department</th>
                <th>Course</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of allStudents; let i = index">
                <td>{{i+1}}</td>
                <td>{{ student.studentName}}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.courseName }}</td>
                <td>{{ student.status }}</td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noStudents>
          <p>No students found under your subjects.</p>
        </ng-template>
      </div>
    </div>

    <!-- Student View -->
    <div *ngIf="hasRole('ROLE_STUDENT')" class="student-dashboard py-5">
      <h2 class="mb-4 text-center text-wieght  rounded p-3 mt-4" style="background-color: #6528F7; margin: 20%;">üéì
        Student Dashboard
      </h2>

      <!-- Profile Section -->
      <div *ngIf="viewSection === 'profile'" class="card p-3 mb-4">
        <h5 class="mb-3" style="color: #41B3A2;">üë§ Profile</h5>
        <ng-container *ngIf="studentProfile; else loadingProfile">
          <ul class="list-group">
            <div class="col-md-4 text-center mb-3">
              <strong>Profile Image:</strong><br />
              <img
                [src]="studentProfile?.profileImagePath ? 'http://localhost:8080' + studentProfile.profileImagePath : 'http://localhost:8080' + '/uploads/assets/default-profile.png'"
                class="img-thumbnail rounded-circle mt-2 profile-thumbnail" alt="Profile Image" />
            </div>
            <li class="list-group-item"><strong>Name:</strong> {{ studentProfile?.name }}</li>
            <li class="list-group-item"><strong>Email:</strong> {{ studentProfile?.email }}</li>
            <li class="list-group-item"><strong>Phone:</strong> {{ studentProfile?.phoneNumber }}</li>
            <li class="list-group-item"><strong>Department:</strong> {{ studentProfile?.departmentName }}</li>
            <li class="list-group-item"><strong>Course Name:</strong> {{ studentProfile?.courseName }}</li>
            <li class="list-group-item"><strong>Subject Name:</strong> {{ studentProfile?.subjectName }}</li>
          </ul>
        </ng-container>
        <ng-template #loadingProfile>
          <p>Loading profile...</p>
        </ng-template>
      </div>

      <!-- Courses Section -->
      <div *ngIf="viewSection === 'courses'" class="card p-3 mb-4">
        <h5 class="mb-3" style="color: #6a1b9a;">üìö Available Courses</h5>
        <ng-container *ngIf="courseList?.length && courseList.length > 0; else noCourses">
          <ul class="list-group">
            <li *ngFor="let course of courseList; let i = index"
              class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ i + 1 }}:</strong> {{ course.courseName }}<br />
                <small>üë®‚Äçüè´ {{ course.staffName || 'Staff Not Assigned' }}</small>
              </div>
              <button class="btn btn-warning " (click)="confirmCourseEnroll(course.id)"><svg
                  xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-pin-angle-fill fs-2" viewBox="0 0 16 16">
                  <path
                    d="M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a6 6 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707s.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a6 6 0 0 1 1.013.16l3.134-3.133a3 3 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146" />
                </svg>Enroll</button>
            </li>
          </ul>
        </ng-container>
        <ng-template #noCourses>
          <p>No courses available at the moment.</p>
        </ng-template>
      </div>

      <!-- Department Info Section -->
      <div *ngIf="viewSection === 'department'" class="card p-3 mb-4">
        <h5 class="mb-3" style="color: #6a1b9a;">üè´ Department Information</h5>

        <ng-container *ngIf="departmentInfo; else loadingDept">
          <p><strong>Department Name:</strong> {{ departmentInfo?.departmentName }}</p>
          <p><strong>HOD:</strong> {{ departmentInfo?.hodName }} ({{ departmentInfo?.hodEmail }})</p>
          <p><strong>Staff Members:</strong></p>
          <ul class="list-group">
            <ng-container *ngIf="departmentInfo.staffNames?.length > 0; else noStaff">
              <li *ngFor="let staff of departmentInfo.staffNames; let i = index" class="list-group-item">
                {{ i + 1 }}. {{ staff }}
              </li>
            </ng-container>
            <ng-template #noStaff>
              <li class="list-group-item text-muted">Not Assigned</li>
            </ng-template>
          </ul>
        </ng-container>
        <ng-template #loadingDept>
          <p>No department info available...</p>
        </ng-template>
      </div>
    </div>
  </div>
</body>