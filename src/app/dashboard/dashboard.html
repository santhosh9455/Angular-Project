<app-navbar [sidebarCollapsed]="sidebarCollapsed" (toggleSidebarEvent)="toggleSidebar()">
</app-navbar>
<app-toast></app-toast>
<app-sidebar [collapsed]="sidebarCollapsed" [userRoles]="userRoles" [activeSection]="viewSection ?? ''"
  (sectionChange)="toggleSection($event)">
</app-sidebar>


<body>
  <div class="main-content" [class.collapsed]="sidebarCollapsed">
    <!-- Admin Dashboard Views -->
    <div *ngIf="hasRole('ROLE_ADMIN')" class="hod-dashboard py-5">
      <div class="container mt-4" *ngIf="viewSection === 'dashboard'">
        <div class="row row-cols-1 mt-4 row-cols-md-3 g-4  w-100 justify-content-center">

          <!-- Total Students -->
          <div class="row row-cols-1 row-cols-md-3 w-100 g-4">
            <!-- Total Students -->
            <div class="col">
              <div class="card bg-gradient-primary text-white shadow-lg rounded-4 h-100 border-0">
                <div class="card-body d-flex flex-column justify-content-between">
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-person-bounding-box fs-3 me-3"></i>
                    <h2 class="mb-0 text-uppercase">Total Students</h2>
                  </div>
                  <h1 class="fw-bold text-center">{{ allStudents.length || 0 }}</h1>
                </div>
              </div>
            </div>

            <!-- Total Users -->
            <div class="col">
              <div class="card bg-gradient-success text-white shadow-lg rounded-4 h-100 border-0">
                <div class="card-body d-flex flex-column justify-content-between">
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-person-lines-fill fs-3 me-3"></i>
                    <h2 class="mb-0 text-uppercase">Total Users</h2>
                  </div>
                  <h1 class="fw-bold text-center">{{ allUsers.length || 0 }}</h1>
                </div>
              </div>
            </div>

            <!-- Staff & HOD -->
            <div class="col">
              <div class="card bg-gradient-info text-white shadow-lg rounded-4 h-100 border-0">
                <div class="card-body d-flex flex-column justify-content-between">
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-people-fill fs-3 me-3"></i>
                    <h2 class="mb-0 text-uppercase">Staff & HOD</h2>
                  </div>
                  <h1 class="fw-bold text-center">{{ UsersProfile.length || 0 }}</h1>
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="container my-4">
          <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">
              <div class="card shadow-lg rounded-4 border-0">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title text-primary fw-bold mb-3 text-center">
                    Department-wise Student Count
                  </h5>
                  <div class="position-relative" style="height: 400px;">
                    <canvas baseChart [data]="barChartData" [options]="barChartOptions" [type]="'bar'">
                    </canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Create User -->

      <div *ngIf="viewSection === 'adminCreateUser'" class="card p-3 mb-4">
        <h5 class="text-primary"> Create New User</h5>
        <form (ngSubmit)="submitCreateUser()">
          <div class="mb-3">
            <label class="form-label">Username<span class="text-danger"> *</span></label>
            <input type="text" class="form-control" [(ngModel)]="newUser.username" name="username" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Password<span class="text-danger"> *</span></label>
            <input type="password" class="form-control" [(ngModel)]="newUser.password" name="password" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Role Name<span class="text-danger"> *</span></label>
            <select name="roleid" class="form-select" [(ngModel)]="newUser.roleId" name="editRole" required>
              <option value="">-- Select Role --</option>
              <option *ngFor="let role of roles" [value]="role.id">{{ role.role?.startsWith('ROLE_') ?
                role.role.substring(5) : role.role || 'Unknown' }}</option>
            </select>
          </div>
          <button type="submit" class="btn btn-info">Create User</button>
        </form>
      </div>

      <!-- Edit User Modal -->
      <!-- Edit User Modal -->
      <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-primary text-white">
              <h2 class="modal-title icon-edit" id="editUserModalLabel">Edit User</h2>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Form Binding -->
            <form #editForm="ngForm" (ngSubmit)="submitUserUpdate()" novalidate>
              <div class="modal-body">
                <!-- Username -->
                <div class="mb-3">
                  <label class="form-label">Username</label>
                  <input type="text" class="form-control" name="editUsername" [(ngModel)]="editUser.username"
                    required />
                </div>

                <!-- Password -->
                <div class="mb-3">
                  <label class="form-label">Password</label>
                  <input type="password" class="form-control" name="editPassword" [(ngModel)]="editUser.password"
                    required />
                </div>

                <!-- Role -->
                <div class="mb-3">
                  <label class="form-label">Role Name</label>
                  <select class="form-select" name="roleId" [(ngModel)]="editUser.roleId" required>
                    <option [ngValue]="null">--Select Role--</option>
                    <option *ngFor="let role of roles" [ngValue]="role.id">
                      {{ role.role.replace('ROLE_', '') }}
                    </option>
                  </select>
                </div>
              </div>

              <!-- Footer -->
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Update User</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Create User Modal -->
      <div class="modal fade" id="createUserModal" tabindex="-1" aria-labelledby="createUserModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content shadow">
            <div class="modal-header bg-primary text-white">
              <h2 class="modal-title" id="createUserModalLabel">Create User</h2>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <form #form="ngForm" (ngSubmit)="submitCreateUser()" novalidate>

              <div class="modal-body">
                <div class="row g-3">
                  <!-- Username -->
                  <div class="col-md-6">
                    <label class="form-label">Username<span class="text-danger"> *</span></label>
                    <input #username="ngModel" type="text" class="form-control" [(ngModel)]="newUser.username"
                      name="username" required />
                    <div class="text-danger" *ngIf="(form.submitted || username.touched) && username.invalid">
                      Username is required
                    </div>
                  </div>

                  <!-- Password -->
                  <div class="col-md-6">
                    <label class="form-label">Password<span class="text-danger"> *</span></label>
                    <input #password="ngModel" type="password" class="form-control" [(ngModel)]="newUser.password"
                      name="password" required />
                    <div class="text-danger" *ngIf="(form.submitted || password.touched) && password.invalid">
                      Password is required
                    </div>

                  </div>

                  <!-- Role -->
                  <div class="col-md-6">
                    <label class="form-label">Role<span class="text-danger"> *</span></label>
                    <select class="form-select" [(ngModel)]="newUser.roleId" name="roleId" required>
                      <option [ngValue]="null">--Select Role--</option>
                      <option *ngFor="let role of roles" [ngValue]="role.id">
                        {{ role.role.replace('ROLE_', '') }}
                      </option>

                    </select>
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-primary" [disabled]="!form.valid">Create User</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>

              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- All Users -->
      <div *ngIf="viewSection === 'adminAllUsers'" class="px-3 py-2">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="text-primary fw-bold"> All Users</h2>
          <button class="btn btn-success" (click)="openCreateUserModal()">
            <i class="bi bi-person-plus-fill me-1"></i> Add User
          </button>
        </div>

        <!-- Filters -->
        <!-- Filters -->
        <div class="row g-2 mb-3">
          <div class="col-md-6">
            <input type="text" class="form-control" placeholder="Search username" [(ngModel)]="searchText"
              (ngModelChange)="onFilterChange()" />
          </div>
          <div class="col-md-6">
            <select class="form-select" [(ngModel)]="userFilterRoleId" (change)="onFilterChange()">
              <option [ngValue]="null">All Roles</option>
              <option *ngFor="let role of roles" [ngValue]="role.id">
                {{ role.role?.startsWith('ROLE_') ? role.role.substring(5) : role.role || 'Unknown' }}
              </option>
            </select>
          </div>
        </div>


        <!-- Table -->
        <mat-table class="table table-hover" style="border: 1px solid #dee2e6e6;" [dataSource]="allUsers" matSort
          (matSortChange)="onSortChange($event)" class="mat-elevation-z2">

          <!-- Index Column -->
          <ng-container matColumnDef="index">
            <mat-header-cell style="background-color:#6a1b9a; color:white" *matHeaderCellDef>S.NO</mat-header-cell>
            <mat-cell *matCellDef="let row; let i = index">{{ (page * size) + i + 1 }}</mat-cell>
          </ng-container>

          <!-- Username Column -->
          <ng-container matColumnDef="username">
            <mat-header-cell style="background-color:#6a1b9a; color:white" *matHeaderCellDef
              mat-sort-header>Username</mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.username }}</mat-cell>
          </ng-container>

          <!-- Role Column -->
          <ng-container matColumnDef="role">
            <mat-header-cell class="color-white" style="background-color:#6a1b9a; color:white" *matHeaderCellDef
              mat-sort-header>Role</mat-header-cell>
            <mat-cell *matCellDef="let row">
              <span class="badge" [ngClass]="{
          'bg-primary': row.role === 'ROLE_ADMIN',
          'bg-warning text-dark': row.role === 'ROLE_STAFF',
          'bg-success': row.role === 'ROLE_STUDENT',
          'bg-secondary': row.role === 'ROLE_HOD'
        }">
                {{ row.role.startsWith('ROLE_') ? row.role.substring(5) : row.role || 'Unknown' }}
              </span>
            </mat-cell>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <mat-header-cell style="background-color:#6a1b9a; color:white" *matHeaderCellDef>Actions</mat-header-cell>
            <mat-cell *matCellDef="let row">
              <button mat-icon-button color="primary" title="Edit" (click)="openEditUserModel(row)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" title="Delete" (click)="deleteUserAuthSwal(row.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table>

        <mat-paginator [length]="totalUsers" [pageSize]="size" [pageIndex]="page" [pageSizeOptions]="[5, 10, 25]"
          (page)="onPageEvent($event)" showFirstLastButtons>
        </mat-paginator>
      </div>

      <!-- All Staff & Hod -->
      <div *ngIf="viewSection === 'adminAllStaffHod'" class="px-2 py-3">
        <!-- Header + Add Button -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="text-primary fw-bold mb-0"> All Staff & HOD</h2>
          <button class="btn btn-success" (click)="openCreateUserProModal()">
            <i class="bi bi-person-plus-fill me-1"></i> Add HOD / Staff
          </button>
        </div>

        <!-- Filters -->
        <div class="row g-2 mb-3">
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder=" Search by name or username" [(ngModel)]="searchText"
              (input)="onFilterChange()" />
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterRole" (change)="onFilterChange()">
              <option value="">All Roles</option>
              <option value="ROLE_STAFF">STAFF</option>
              <option value="ROLE_HOD">HOD</option>
            </select>
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterDepartment" (change)="onFilterChange()">
              <option [ngValue]="null">All Departments</option>
              <option *ngFor="let dept of departments" [ngValue]="dept.id">{{ dept.departmentName }}
              </option>
            </select>
          </div>
        </div>

        <!-- Table -->
        <table class="table table-hover table-bordered text-start align-middle">
          <thead class="table-light text-start">
            <tr>
              <th>S.No</th>
              <th>Name</th>
              <th>Role</th>
              <th>Username</th>
              <th>Phone</th>
              <th>Department</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of UsersProfile; let i = index">
              <td>{{ i + 1 + (page * size) }}</td>
              <td>{{ user.name || 'N/A'}}</td>
              <td class="text-center m-0 p-0">
                <span
                  class="badge bg-{{ user.role === 'ROLE_HOD' ? 'success' : user.role === 'ROLE_STAFF' ? 'warning text-dark' : 'danger' }} text-start">
                  {{ user.role?.startsWith('ROLE_') ? user.role?.substring(5)
                  : user.role
                  || 'N/A' }}
                </span>
              </td>
              <td>{{ user.username || 'N/A' }}</td>
              <td>{{ user.phoneNumber || 'N/A' }}</td>
              <td>{{ user.departmentName || 'N/A' }}</td>
              <td class="d-flex justify-content-center">
                <button class="btn btn-outline-info btn-sm me-1" title="View" (click)="viewUsersProfile(user)">
                  <i class="bi bi-eye-fill"></i>
                </button>
                <button class="btn btn-outline-warning btn-sm me-1" title="Edit" (click)="openEditUserModal(user)">
                  <i class="bi bi-pencil-fill"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm" title="Delete" (click)="deleteUserSwal(user.id)">
                  <i class="bi bi-trash3-fill"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="UsersProfile.length === 0">
              <td colspan="7" class="text-muted">No users found.</td>
            </tr>
          </tbody>
        </table>
        <!-- Pagination Controls -->
        <nav *ngIf="totalPages > 0" aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="page === 0">
              <button type="button" class="page-link" (click)="onPageChange(page - 1)">Previous</button>
            </li>
            <li class="page-item disabled">
              <span class="page-link">Page {{ page + 1 }} of {{ totalPages }}</span>
            </li>
            <li class="page-item" [class.disabled]="page + 1 >= totalPages">
              <button type="button" class="page-link" (click)="onPageChange(page + 1)">Next</button>
            </li>
          </ul>
        </nav>


        <!-- Create User Modal -->
        <div class="modal fade" id="createUserProModal" tabindex="-1" aria-labelledby="createUserModalLabel"
          aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content shadow">
              <div class="modal-header bg-primary text-white">
                <h2 class="modal-title" id="createUserModalLabel"> Create HOD / Staff</h2>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                  aria-label="Close"></button>
              </div>
              <form #form="ngForm" (ngSubmit)="submitCreateUserPro()" novalidate>

                <div class="modal-body">
                  <div class="row g-3">
                    <!-- Name -->
                    <div class="col-md-6">
                      <label class="form-label">Name<span class="text-danger"> *</span></label>
                      <input type="text" class="form-control" name="name" required [(ngModel)]="newUserPro.name"
                        #name="ngModel" />
                      <div class="text-danger" *ngIf="(form.submitted || name.touched) && name.invalid">
                        Name is required
                      </div>
                    </div>

                    <!-- Email -->
                    <div class="col-md-6">
                      <label class="form-label">Email<span class="text-danger"> *</span></label>
                      <input type="email" class="form-control" name="email" required [(ngModel)]="newUserPro.email"
                        #email="ngModel" />
                      <div class="text-danger" *ngIf="(form.submitted || email.touched) && email.invalid">
                        Valid email is required
                      </div>
                    </div>

                    <!-- Phone -->
                    <div class="col-md-6">
                      <label class="form-label">Phone Number<span class="text-danger"> *</span></label>
                      <input type="text" class="form-control" name="phoneNumber" required pattern="^[0-9]{10}$"
                        [(ngModel)]="newUserPro.phoneNumber" #phoneNumber="ngModel" />
                      <div class="text-danger" *ngIf="(form.submitted || phoneNumber.touched) && phoneNumber.invalid">
                        Enter valid 10-digit phone number
                      </div>
                    </div>

                    <!-- Gender -->
                    <div class="col-md-6">
                      <label class="form-label">Gender<span class="text-danger"> *</span></label>
                      <select class="form-select" name="gender" required [(ngModel)]="newUserPro.gender"
                        #gender="ngModel">
                        <option value="">-- Select Gender --</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                      </select>
                      <div class="text-danger" *ngIf="(form.submitted || gender.touched) && gender.invalid">
                        Gender is required
                      </div>
                    </div>

                    <!-- DOB -->
                    <div class="col-md-6">
                      <label class="form-label">Date of Birth<span class="text-danger"> *</span></label>
                      <input type="date" class="form-control" name="dateOfBirth" required
                        [(ngModel)]="newUserPro.dateOfBirth" #dateOfBirth="ngModel" />
                      <div class="text-danger" *ngIf="(form.submitted || dateOfBirth.touched) && dateOfBirth.invalid">
                        Date of birth is required
                      </div>
                    </div>

                    <!-- Role -->
                    <div class="col-md-6">
                      <label class="form-label">Role<span class="text-danger"> *</span></label>
                      <select class="form-select" name="roleId" required [(ngModel)]="newUserPro.roleId"
                        #roleId="ngModel">
                        <option value="">-- Select Role --</option>
                        <ng-container *ngFor="let role of roles">
                          <option *ngIf="role.role === 'ROLE_HOD' || role.role === 'ROLE_STAFF'" [value]="role.id">
                            {{ role.role.startsWith('ROLE_') ? role.role.substring(5) : role.role || 'N/A' }}
                          </option>
                        </ng-container>
                      </select>
                      <div class="text-danger" *ngIf="(form.submitted || roleId.touched) && roleId.invalid">
                        Role is required
                      </div>
                    </div>

                    <!-- Department (optional but can add required if needed) -->
                    <div class="col-md-6">
                      <label class="form-label">Department<span class="text-danger"> *</span></label>
                      <select class="form-select" [(ngModel)]="newUserPro.departmentId" name="departmentId"
                        #departmentId="ngModel">
                        <option value="">-- Select Department --</option>
                        <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.departmentName
                          }}</option>
                      </select>
                      <div class="text-danger" *ngIf="(form.submitted || departmentId.touched) && departmentId.invalid">
                        Department is required
                      </div>
                    </div>

                    <!-- Subject (optional) -->
                    <div class="col-md-6">
                      <label class="form-label">Subject</label>
                      <ng-select class="form-select" [items]="subjects " bindLabel="subjectName" bindValue="id"
                        [(ngModel)]="newUserPro.subjectId" name="subjectId" [searchable]="true" [clearable]="true"
                        [multiple]="true">
                      </ng-select>
                    </div>

                    <!-- Course (optional) -->
                    <div class="col-md-6">
                      <label class="form-label">Course</label>
                      <ng-select class="form-select" [items]="Courses" bindLabel="courseName" bindValue="id"
                        [(ngModel)]="newUserPro.courseId" name="courseId" [searchable]="true" [clearable]="true">
                      </ng-select>
                    </div>

                  </div>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-success" [disabled]="form.invalid">Create</button>
                  <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Edit User Modal -->
        <div class="modal fade" id="editUserProModal" tabindex="-1" aria-labelledby="editUserProModalLabel"
          aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content rounded-4 shadow">
              <div class="modal-header bg-primary text-white">
                <h2 class="modal-title" id="editUserProModalLabel">
                  <i class="bi bi-pencil-square me-2"></i> Edit HOD / Staff
                </h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                  (click)="closeModal()"></button>
              </div>

              <form #editUserForm="ngForm" (ngSubmit)="updateUserPartial()" novalidate>
                <div class="modal-body">
                  <div class="row g-3">
                    <!-- Name -->
                    <div class="col-md-6">
                      <label for="editName" class="form-label">Name</label>
                      <input id="editName" name="name" #name="ngModel" type="text" class="form-control"
                        [(ngModel)]="editUserPro.name" required />

                    </div>

                    <div class="col-md-6">
                      <label for="editEmail" class="form-label">Email</label>
                      <input id="editEmail" name="email" type="email" class="form-control"
                        [(ngModel)]="editUserPro.email" required email #email="ngModel" />

                    </div>


                    <!-- Phone -->
                    <div class="col-md-6">
                      <label for="editPhone" class="form-label">Phone</label>
                      <input id="editPhone" name="phoneNumber" type="text" class="form-control"
                        [(ngModel)]="editUserPro.phoneNumber" required #phoneNumber="ngModel" />

                    </div>

                    <!-- Gender -->
                    <div class="col-md-6">
                      <label for="editGender" class="form-label">Gender</label>
                      <select class="form-select" name="gender" required [(ngModel)]="editUserPro.gender"
                        #gender="ngModel">
                        <option [ngValue]="null">-- Select Gender --</option>
                        <option [ngValue]="'Male'">Male</option>
                        <option [ngValue]="'Female'">Female</option>
                      </select>

                    </div>

                    <!-- DOB -->
                    <div class="col-md-6">
                      <label for="editDOB" class="form-label">Date of Birth</label>
                      <input id="editDOB" name="dateOfBirth" type="date" class="form-control"
                        [(ngModel)]="editUserPro.dateOfBirth" required #dateOfBirth="ngModel" />

                    </div>

                    <!-- Department -->
                    <div class="col-md-6">
                      <label for="editDepartment" class="form-label">Department</label>
                      <select id="editDepartment" name="departmentId" class="form-select"
                        [(ngModel)]="editUserPro.departmentId" required #departmentId="ngModel">
                        <option [ngValue]="null">Select Department</option>
                        <option *ngFor="let dept of departments" [ngValue]="dept.id">{{
                          dept.departmentName }}</option>
                      </select>

                    </div>

                    <!-- Subject -->
                    <div class="col-md-6">
                      <label class="form-label">Subjects</label>
                      <ng-select class="form-select" [items]="subjects" bindLabel="subjectName" bindValue="id"
                        [(ngModel)]="editUserPro.subjectId" name="subjectIds" [searchable]="true" [clearable]="true"
                        [multiple]="true"> <!-- ✅ Enables multiple selection -->
                      </ng-select>
                    </div>


                    <!-- Course -->
                    <div class="col-md-6">
                      <label for="editCourse" class="form-label">Course</label>
                      <ng-select class="form-select" [items]="Courses" bindLabel="courseName" bindValue="id"
                        [(ngModel)]="editUserPro.courseId" name="courseId" [searchable]="true" [clearable]="true">
                      </ng-select>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">User Name</label>
                      <input type="text" class="form-control" name="username" required
                        [(ngModel)]="editUserPro.username" #username="ngModel" />
                    </div>
                  </div>

                </div>

                <div class="modal-footer">
                  <button class="btn btn-secondary" type="button" data-bs-dismiss="modal"
                    (click)="closeModal()">Cancel</button>
                  <button class="btn btn-primary" type="submit">
                    <i class="bi bi-save me-1"></i> Save Changes
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- View User Profile Modal -->
        <div class="modal fade" id="viewUserProModal" tabindex="-1" aria-labelledby="viewUserProModal"
          aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">

              <!-- Modal Header -->
              <div class="modal-header bg-info text-white">
                <h2 class="modal-title"> Staff / HOD Profile</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

              <!-- Modal Body -->
              <div class="modal-body">
                <div class="container-fluid">

                  <!-- Profile Image and Basic -->
                  <div class="row mb-3">
                    <div class="col text-center">
                      <img [src]="'http://localhost:8080/uploads/assets/default-profile.png'" alt="Profile"
                        class="rounded-circle shadow" width="100" height="100">
                      <h3 class="mt-2 text-dark">{{ selectedUserProfile?.name }}</h3>

                      <span class="badge bg-primary">{{ selectedUserProfile?.username }}</span>
                    </div>
                  </div>

                  <!-- Info Cards -->
                  <div class="row g-4">

                    <!-- Contact Info -->
                    <div class="col-md-6">
                      <div class="card info-card border-0 shadow-sm violet-card text-white" style="height: 216px;">
                        <div class="card-body">
                          <h2 class="card-title mb-3"><i class="bi bi-envelope me-2"></i>Contact Info
                          </h2>
                          <p class="mb-2">
                            <i class="bi bi-envelope-open me-2">Email:</i>
                            {{ selectedUserProfile?.email }}
                          </p>
                          <p>
                            <i class="bi bi-telephone-fill me-2">Phone:</i>
                            {{ selectedUserProfile?.phoneNumber }}
                          </p>
                        </div>
                      </div>
                    </div>

                    <!-- Personal Info -->
                    <div class="col-md-6">
                      <div class="card info-card border-0 shadow-sm violet-card text-white">
                        <div class="card-body">
                          <h2 class="card-title mb-3"><i class="bi bi-person-fill me-2"></i>Personal Info
                          </h2>
                          <p class="mb-2">
                            <i class="bi bi-gender-ambiguous me-2">Gender:</i>
                            {{ selectedUserProfile?.gender || 'N/A'}}
                          </p>
                          <p>
                            <i class="bi bi-calendar-fill me-2">Age:</i>
                            {{ selectedUserProfile?.age || 'N/A'}}
                          </p>
                          <p>
                            <i class="bi bi-building-fill me-2">Date of Birth:</i>
                            {{ selectedUserProfile?.dateOfBirth || 'N/A' }}
                          </p>
                        </div>
                      </div>
                    </div>

                    <!-- Academic Info -->
                    <div class="col-md-12">
                      <div class="card info-card border-0 shadow-sm violet-card text-white">
                        <div class="card-body">
                          <h2 class="card-title mb-3"><i class="bi bi-journal-text me-2"></i>Academic Info
                          </h2>
                          <div class="row">
                            <div class="col-md-4 mb-2">
                              <i class="bi bi-book me-2">Course:</i>
                              {{ selectedUserProfile?.courseName || 'Not Assigned' }}
                            </div>
                            <div class="col-md-4 mb-2">
                              <i class="bi bi-easel2-fill me-2">Subject:</i>
                              <ul class="list-styled ">
                                <li class="pt-0" *ngFor="let subject of selectedUserProfile?.subjectName || ['N/A']">
                                  <p class="small">{{ subject }}</p>
                                </li>
                              </ul>
                            </div>
                            <div class="col-md-4 mb-2">
                              <i class="bi bi-building me-2">Department:</i>
                              {{ selectedUserProfile?.departmentName || 'Not Assigned' }}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div> <!-- row -->

                </div> <!-- container-fluid -->
              </div> <!-- modal-body -->

              <!-- Modal Footer -->
              <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>

            </div>
          </div>
        </div>

        <!-- Full View of Staff and Admin-->

      </div>
      <!-- All Students -->
      <div *ngIf="viewSection === 'adminAllStudents'" class="px-3 py-2">
        <!-- Header and Add Button -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <!-- Title on the left -->
          <h2 class="text-primary m-0">All Students</h2>

          <!-- Buttons on the right -->
          <div class="d-flex align-items-center gap-2">
            <!-- Add Student Button -->
            <button class="btn btn-success" data-bs-toggle="modal" (click)="createStudentModal()"
              data-bs-target="#createStudentModal">
              <i class="bi bi-person-plus-fill me-1"></i> Add Student
            </button>

            <!-- Download Dropdown Button -->
            <div class="dropdown">
              <button class="btn btn-primary rounded-circle dropdown-toggle" type="button" data-bs-toggle="dropdown"
                style="width: 50px; height: 50px;">
                <i class="bi bi-download"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li class="dropdown-header text-center fw-bold">Current Page</li>
                <li><a class="list-bg  dropdown-item" role="button" (click)="downloadReport('pdf')">PDF</a></li>
                <li><a class="list-bg  dropdown-item" role="button" (click)="downloadReport('excel')">Excel</a></li>
                <li><a class="list-bg  dropdown-item" role="button" (click)="downloadReport('csv')">CSV</a></li>
                <li>
                  <hr class="list-bg  dropdown-divider">
                </li>
                <li class="list-bg  dropdown-header text-center fw-bold">Download All</li>
                <li><a class="list-bg  dropdown-item" role="button" (click)="downloadReport('pdf', true)">PDF (All)</a>
                </li>
                <li><a class="list-bg  dropdown-item" role="button" (click)="downloadReport('excel', true)">Excel
                    (All)</a></li>
                <li><a class="list-bg  dropdown-item" role="button" (click)="downloadReport('csv', true)">CSV (All)</a>
                </li>
              </ul>
            </div>
          </div>
        </div>




        <!-- Filters -->
        <div class="row g-2 mb-3">
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder=" Name or Username" [(ngModel)]="searchText"
              (ngModelChange)="onFilterChange()" />
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterDepartment" (change)="onFilterChange()">
              <option [ngValue]="null">All Departments</option>
              <option *ngFor="let d of departments" [ngValue]="d.id">{{ d.departmentName }}</option>
            </select>
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterStatus" (change)="onFilterChange()">
              <option value="">All Status</option>
              <option value="PENDING">Pending</option>
              <option value="APPROVED">Approved</option>
              <option value="REJECTED">Rejected</option>
            </select>
          </div>
        </div>


        <!-- Table -->
        <div class="table-responsive">
          <table class="table table-bordered table-hover text-center align-middle">
            <thead class="table-light">
              <tr>
                <th>S.NO</th>
                <th>Name</th>
                <th>Username</th>
                <th>Phone</th>
                <th>Department</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of students; let i = index">
                <td>{{ (page * size) + i + 1 }}</td>
                <td>{{ student.name || 'N/A' }}</td>
                <td>{{ student.username || 'N/A' }}</td>
                <td>{{ student.phoneNumber || 'N/A' }}</td>
                <td>{{ student.departmentName || 'N/A' }}</td>
                <td class="text-center m-0 p-0">
                  <span
                    class="badge bg-{{ student.status === 'APPROVED' ? 'success' : student.status === 'PENDING' ? 'warning text-dark' : 'danger' }}">
                    {{ student.status }}
                  </span>
                </td>
                <td class="d-flex justify-content-center gap-2 border-right-0">
                  <button class="btn btn-outline-info btn-sm" title="View" (click)="viewStudentProfile(student)">
                    <i class="bi bi-eye"></i>
                  </button>
                  <button class="btn btn-outline-warning btn-sm" title="Edit" (click)="openEditStudentModal(student)">
                    <i class="bi bi-pencil-square"></i>
                  </button>
                  <button class="btn btn-outline-danger btn-sm" title="Delete" (click)="deleteStudentSwal(student.id)">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
              <tr *ngIf="students.length === 0">
                <td colspan="7" class="text-muted">No students found.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <nav *ngIf="totalPages > 0" class="mt-2">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="page === 0">
              <button type="button" class="page-link" (click)="onPageChange(page - 1)">Previous</button>
            </li>
            <li class="page-item disabled">
              <span class="page-link">Page {{ page + 1 }} of {{ totalPages }}</span>
            </li>
            <li class="page-item" [class.disabled]="page + 1 >= totalPages">
              <button type="button" class="page-link" (click)="onPageChange(page + 1)">Next</button>
            </li>
          </ul>
        </nav>
      </div>

      <div *ngIf="viewSection === 'adminDepartment'" class="px-3 py-2">

        <div class="container mt-4">
          <mat-card class="mat">
            <mat-card-title class="text-primary">Department List</mat-card-title>

            <div class="d-flex justify-content-end align-items-end mb-3">
              <button type="button" class="btn btn-success " (click)="openNewDepartmentModal()">New Department</button>
            </div>
            <!-- Search -->
            <mat-form-field class="w-50" appearance="outline">
              <mat-label>Search Departments</mat-label>
              <input matInput [(ngModel)]="searchText" (keyup)="loadDepartments()" placeholder="Type to search..." />
            </mat-form-field>

            <!-- Table -->
            <div class="table-responsive">
              <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 w-100">

                <!-- Index Column -->
                <ng-container matColumnDef="index">
                  <th mat-header-cell *matHeaderCellDef style=" background-color: #6a1b9a; color: #f5f5f5;"> S.NO</th>
                  <td mat-cell *matCellDef="let dept; let i = index">
                    {{ i + 1 + page * pageSize }}
                  </td>
                </ng-container>

                <!-- Department Name Column -->
                <ng-container matColumnDef="departmentName">
                  <th mat-header-cell *matHeaderCellDef style=" background-color: #6a1b9a; color: #f5f5f5;"> Department
                    Name </th>
                  <td mat-cell *matCellDef="let dept"> {{ dept.departmentName }} </td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef style="background-color: #6a1b9a; color: #f5f5f5;"> Actions
                  </th>
                  <td mat-cell *matCellDef="let dept">
                    <button mat-icon-button color="primary" title="Edit" (click)="editDepartment(dept)">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" title="delete" (click)="deleteDepartment(dept.id)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <!-- Header and Row Definitions -->
                <tr mat-header-row *matHeaderRowDef="displayedColumnsdept"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumnsdept;"></tr>
              </table>
            </div>

            <!-- Paginator -->
            <mat-paginator [length]="totalElements" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 20]"
              (page)="onPageChangeDept($event)">
            </mat-paginator>
          </mat-card>
        </div>
      </div>


      <div class="modal fade" id="newDepartmentModal" tabindex="-1" aria-labelledby="createDepartmentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <form #deptForm="ngForm" (ngSubmit)="AdminsubmitCreateDepartment()">
              <div class="modal-header bg-primary text-white">
                <h2 class="modal-title" id="createDepartmentModalLabel">New Department</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

              <div class="modal-body">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Department Name</label>
                    <span class="text-danger">*</span>

                    <input type="text" class="form-control" name="departmentName" [(ngModel)]="newDepartmentName"
                      #deptName="ngModel" required />

                    <!-- ✅ Validation Error -->
                    <div *ngIf="deptName.invalid && (deptName.dirty || deptName.touched || deptForm.submitted)">
                      <small class="text-danger">Department name is required.</small>
                    </div>
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">New</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                  (click)="resetDepForm()">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="modal fade" id="editDepartmentModal" tabindex="-1" aria-labelledby="editDepartmentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <form #deptForm="ngForm" (ngSubmit)="AdminEditDept()">
              <div class="modal-header bg-primary text-white">
                <h2 class="modal-title" id="createDepartmentModalLabel">Update Department</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

              <div class="modal-body">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Department Name</label>
                    <input type="text" class="form-control" name="departmentName" [(ngModel)]="newDepartmentName"
                      #deptName="ngModel" required />
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Update</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                  (click)="resetDepForm()">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>


      <!-- Update Student -->
      <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <form (ngSubmit)="AdminsubmitUpdateStudent()">
              <div class="modal-header bg-primary text-white">
                <h2 class="modal-title" id="editStudentModalLabel"> Update Student</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.name" name="studentName"
                      required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Date Of Birth</label>
                    <input type="date" class="form-control" [(ngModel)]="studentEdit.dateOfBirth" name="studentAge" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Gender</label>
                    <select class="form-select" [(ngModel)]="studentEdit.gender" name="studentGender">
                      <option value="">-- Select Gender --</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" [(ngModel)]="studentEdit.email" name="studentEmail"
                      required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" [(ngModel)]="studentEdit.phoneNumber" name="studentPhone" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Department</label>
                    <select class="form-select" [(ngModel)]="studentEdit.departmentId" name="studentDepartment">
                      <option value="">-- Select Department --</option>
                      <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.departmentName }}
                      </option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="editCourse" class="form-label">Course Name</label>
                    <ng-select class="form-select" name="studentCourse" [items]="Courses" bindLabel="courseName"
                      bindValue="id" [(ngModel)]="studentEdit.courseId" name="courseId" [searchable]="true"
                      [clearable]="true">
                    </ng-select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Subjects</label>
                    <ng-select class="form-select" name="subjectId" [items]="subjects" bindLabel="subjectName"
                      bindValue="id" [(ngModel)]="studentEdit.subjectId" name="subjectIds" [searchable]="true"
                      [clearable]="true" [multiple]="true"> <!-- ✅ Enables multiple selection -->
                    </ng-select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Status</label>
                    <select class="form-select" name="status" [(ngModel)]="studentEdit.status" id="status">
                      <option value="">--Select Status--</option>
                      <option value="PENDING">PENDING</option>
                      <option value="APPROVED">APPROVED</option>
                      <option value="REJECTED">REJECTED</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Course Status</label>
                    <select class="form-select" name="courseStatus" [(ngModel)]="studentEdit.courseStatus"
                      id="courseStatus">
                      <option value="">--Select Course Status--</option>
                      <option value="NOT_REQUESTED">NOT_REQUESTED</option>
                      <option value="APPROVED">APPROVED</option>
                      <option value="REJECTED">REJECTED</option>
                      <option value="PENDING">PENDING</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Profile Image</label>
                    <input type="file" class="form-control" (change)="onProfileImageSelected($event)">
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Marksheet Image</label>
                    <input type="file" class="form-control" (change)="onMarksheetImageSelected($event)">
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">User Name</label>
                    <input type="text" class="form-control" name="username" required [(ngModel)]="studentEdit.username"
                      #username="ngModel" />
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Create Student Modal -->
    <div class="modal fade" id="createStudentModal" tabindex="-1" aria-labelledby="createStudentModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <form (ngSubmit)="AdminSubmitCreateStudent()" #createStudentForm="ngForm">
            <div class="modal-header bg-primary text-white">
              <h2 class="modal-title">Create New Student</h2>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <div class="row">
                <!-- Name -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Name<span class="text-danger"> *</span></label>
                  <input #name="ngModel" type="text" class="form-control" [(ngModel)]="newStudent.name" name="name"
                    required />
                  <div class="text-danger" *ngIf="name.invalid && (name.dirty || name.touched)">Name is required</div>
                </div>

                <!-- Age -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Age<span class="text-danger"> *</span></label>
                  <input #age="ngModel" type="number" class="form-control" [(ngModel)]="newStudent.age" name="age"
                    required min="10" max="100" />
                  <div class="text-danger" *ngIf="age.errors?.['required'] && age.touched">Age is required</div>
                  <div class="text-danger" *ngIf="(age.errors?.['min'] || age.errors?.['max']) && age.touched">Age must
                    be
                    between 10 and 100</div>
                </div>

                <!-- Gender -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Gender<span class="text-danger"> *</span></label>
                  <select #gender="ngModel" class="form-select" [(ngModel)]="newStudent.gender" name="gender" required>
                    <option value="">-- Select Gender --</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                  </select>
                  <div class="text-danger" *ngIf="gender.invalid && (gender.dirty || gender.touched)">Gender is required
                  </div>
                </div>

                <!-- Email -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Email<span class="text-danger"> *</span></label>
                  <input #email="ngModel" type="email" class="form-control" [(ngModel)]="newStudent.email" name="email"
                    required />
                  <div class="text-danger" *ngIf="email.invalid && (email.dirty || email.touched)">Valid email is
                    required</div>
                </div>

                <!-- Phone -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Phone Number<span class="text-danger"> *</span></label>
                  <input #phoneNumber="ngModel" type="tel" class="form-control" [(ngModel)]="newStudent.phoneNumber"
                    name="phoneNumber" required pattern="^[0-9]{10}$" />
                  <div class="text-danger" *ngIf="phoneNumber.errors?.['required'] && phoneNumber.touched">Phone number
                    is
                    required</div>
                  <div class="text-danger" *ngIf="phoneNumber.errors?.['pattern'] && phoneNumber.touched">
                    Phone number must be 10 digits
                  </div>
                </div>

                <!-- Department -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Department<span class="text-danger"> *</span></label>
                  <select class="form-select" [(ngModel)]="newStudent.departmentId" name="departmentId" required>
                    <option value="">-- Select Department --</option>
                    <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.departmentName }}</option>
                  </select>
                </div>

                <div class="col-md-6 mb-3">
                  <label for="editCourse" class="form-label">Course Name</label>
                  <ng-select class="form-select" name="studentCourse" [items]="Courses" bindLabel="courseName"
                    bindValue="id" [(ngModel)]="newStudent.courseId" name="courseId" [searchable]="true"
                    [clearable]="true">
                  </ng-select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Subjects</label>
                  <ng-select class="form-select" name="subjectId" [items]="subjects" bindLabel="subjectName"
                    bindValue="id" [(ngModel)]="newStudent.subjectId" name="subjectIds" [searchable]="true"
                    [clearable]="true" [multiple]="true"> <!-- ✅ Enables multiple selection -->
                  </ng-select>
                </div>

                <!-- Profile Image -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Profile Image<span class="text-danger"> *</span></label>
                  <input type="file" class="form-control" (change)="onProfileImageSelected2($event)" required />
                </div>

                <!-- Marksheet Image -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Marksheet Image<span class="text-danger"> *</span></label>
                  <input type="file" class="form-control" (change)="onMarksheetImageSelected2($event)" required />
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button type="submit" class="btn btn-success" [disabled]="createStudentForm.invalid">Create
                Student</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>

        </div>
      </div>
    </div>

    <!-- View Student Profile Modal -->

    <div class="modal fade" id="viewStudentModal" tabindex="-1" aria-labelledby="viewStudentModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content rounded-4 shadow-lg border-0">
          <div class="modal-header bg-gradient bg-info text-white">
            <h2 class="modal-title" id="viewStudentModalLabel">
              <i class="bi bi-person-circle me-2"></i> Student Full Profile
            </h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body p-4">
            <!-- Top: Profile + Info -->
            <div class="row">
              <!-- Profile Image -->
              <div class="col-md-4 text-center mb-4">
                <img
                  [src]="selectedStudent?.profileImagePath ? 'http://localhost:8080' + selectedStudent.profileImagePath : 'http://localhost:8080/uploads/assets/default-profile.png'"
                  alt="Profile" class="rounded-circle shadow mb-3"
                  style="width: 150px; height: 150px; object-fit: cover;" />
                <h5 class="fw-semibold mt-2">{{ selectedStudent?.name }}</h5>
                <p class="text-muted mb-1">{{ selectedStudent?.email }}</p>
                <span
                  class="badge bg-{{ selectedStudent?.status === 'APPROVED' ? 'success' : selectedStudent?.status === 'PENDING' ? 'warning text-dark' : 'danger' }}">
                  {{ selectedStudent?.status }}
                </span>
              </div>

              <!-- Details -->
              <div class="col-md-8">
                <div class="card border-0 shadow-sm rounded-4">
                  <div class="card-body p-4">
                    <h3 class="mb-3 text-primary"><i class="bi bi-person-lines-fill me-2"></i>Student
                      Details</h3>
                    <div class="row g-3">
                      <!-- Column 1 -->
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Username</p>
                        <h4>{{ selectedStudent?.username }}</h4>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Phone</p>
                        <h4>{{ selectedStudent?.phoneNumber }}</h4>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Gender</p>
                        <h4>{{ selectedStudent?.gender }}</h4>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Age</p>
                        <h4>{{ selectedStudent?.age || "N/A" }}</h4>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Date Of Birth</p>
                        <h4>{{ selectedStudent?.dateOfBirth || "N/A" }}</h4>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Department</p>
                        <h4>{{ selectedStudent?.departmentName }}</h4>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Subject</p>
                        <ul class="list-styled ">
                          <li class="pt-0" *ngFor="let subject of selectedStudent?.subjectName || ['N/A']">
                            <p class="small">{{ subject }}</p>
                          </li>
                        </ul>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Course</p>
                        <h4>{{ selectedStudent?.courseName || 'N/A' }}</h4>
                      </div>
                      <div class="col-sm-6">
                        <p class="mb-1 text-muted small">Course Status</p>
                        <h4>{{ selectedStudent?.courseStatus || 'N/A' }}</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <!-- Divider -->
            <hr class="my-4" />

            <!-- Marksheet -->
            <div class="text-center">
              <h2 class="text-muted mb-2">Marksheet Preview</h2>
              <img
                [src]="selectedStudent?.marksheetImagePath ? 'http://localhost:8080' + selectedStudent.marksheetImagePath : 'http://localhost:8080/uploads/assets/default-marksheet.png'"
                alt="Marksheet" class="img-fluid rounded shadow" style="max-height: 500px;" />
            </div>
          </div>

          <div class="modal-footer bg-light border-top-0">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
              <i class="bi bi-x-lg me-1"></i> Close
            </button>
          </div>
        </div>
      </div>


    </div>

    <!-- End Admin View -->


    <!-- HOD View Section -->
    <div *ngIf="hasRole('ROLE_HOD')" class="hod-dashboard py-5">
      <!-- Requested Students Table -->
      <div *ngIf="viewSection === 'hodprofile'">
        <div class="container mt-4" *ngIf="!isLoading; else loading">
          <div class="card border-0 shadow-sm rounded-4 overflow-hidden">

            <!-- Profile Header -->
            <div class="bg-gradient-primary text-white text-center p-4 position-relative">
              <img src="https://ui-avatars.com/api/?name={{ profileData.name }}&size=120&background=0D6EFD&color=fff"
                alt="Profile Avatar" class="rounded-circle border border-3 border-white shadow-sm mb-3" width="120"
                height="120" />
              <h4 class="fw-bold mb-1">{{ profileData.name }}</h4>
              <p class="text-white-300 mb-0">{{ profileData.username }}</p>
            </div>

            <!-- Profile Details -->
            <div class="card-body p-4">
              <div class="row g-4">
                <div class="col-md-6">
                  <ul class="list-unstyled mb-0">
                    <li class="mb-2"><i class="bi bi-envelope me-2 text-primary"></i> <strong>Email:</strong> {{
                      profileData.email }}</li>
                    <li class="mb-2"><i class="bi bi-phone me-2 text-success"></i> <strong>Phone:</strong> {{
                      profileData.phoneNumber }}</li>
                    <li class="mb-2"><i class="bi bi-calendar me-2 text-info"></i> <strong>Age:</strong> {{
                      profileData.age }}</li>
                    <li class="mb-2"><i class="bi bi-gender-ambiguous me-2 text-warning"></i> <strong>Gender:</strong>
                      {{ profileData.gender }}</li>
                  </ul>
                </div>

                <div class="col-md-6">
                  <ul class="list-unstyled mb-0">
                    <li class="mb-2"><i class="bi bi-building me-2 text-danger"></i> <strong>Department:</strong> {{
                      profileData.departmentName }}</li>
                    <li class="mb-2"><i class="bi bi-journal-bookmark me-2 text-secondary"></i> <strong>Course:</strong>
                      {{ profileData.courseName }} <span class="text-muted">(ID: {{ profileData.courseId }})</span></li>
                    <li class="mb-2"><i class="bi bi-bookmarks me-2 text-primary"></i> <strong>Subjects:</strong></li>
                    <div>
                      <span class="badge rounded-pill bg-light text-dark border me-2 mb-2"
                        *ngFor="let subject of profileData.subjectNme">
                        {{ subject }}
                      </span>
                    </div>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Loading Spinner -->
        <ng-template #loading>
          <div class="d-flex justify-content-center mt-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </ng-template>
      </div>

      <div *ngIf="viewSection === 'hodRequested'">
        <h2 class="text-primary fw-bold mb-3">Students</h2>
        <div class="mb-3 row g-2 align-items-center">
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder=" Filter by name" [(ngModel)]="filterName"
              (input)="onRequestedFilterChange()" />
          </div>
          <div class="col-md-4">
            <select class="form-select" [(ngModel)]="filterStatus" (change)="onRequestedFilterChange()">
              <option value="">ALL STATUS</option>
              <option value="APPROVED">APPROVED</option>
              <option value="REJECTED">REJECTED</option>
              <option value="PENDING">PENDING</option>
            </select>
          </div>
        </div>
        <ng-container *ngIf="hodRequested?.length && hodRequested.length > 0; else noRequested">
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>S.NO</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Department</th>
                <th>Status </th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of hodRequested; let i = index">
                <td>{{ (coursePage * courseSize) + i + 1 }}</td>
                <td>{{ student.name }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.phoneNumber }}</td>
                <td>{{ student.departmentName }}</td>
                <td class="text-center">
                  <span class="badge" [ngClass]="{
          'bg-success': student.status === 'APPROVED',
          'bg-secondary': student.status === 'REJECTED',
          'bg-danger text-dark': student.status === 'PENDING'
        }">
                    {{ student.status }}
                  </span>
                </td>
                <td class="text-center">
                  <button class="btn btn-outline-success btn-sm me-2 sm-mb-2"
                    (click)="confirmStudentAction(student.id, 'approve')"><i class="bi bi-patch-check"
                      title="Approve"></i></button>
                  <button class="btn btn-outline-secondary sm-my-2 sm-mb-2 btn-sm me-2"
                    (click)="confirmStudentAction(student.id, 'reject')"><i class="bi bi-x-octagon"
                      title="Reject"></i></button>
                  <button class="btn btn-outline-info btn-sm me-2 sm-mb-2" (click)="viewStudentProfile(student)">
                    <i class="bi bi-eye"></i>
                  </button>
                  <button class="btn btn-outline-warning btn-sm me-2 sm-mb-2" (click)="openEditStudentModal(student)"><i
                      class="bi bi-pencil-square" title="Edit"></i>
                  </button>
                  <button class="btn btn-outline-danger btn-sm sm-mb-2"
                    (click)="openHodStudentDeleteModel(student.id)"><i class="bi bi-trash3-fill"
                      title="Delete"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Pagination -->
          <nav class="d-flex justify-content-center">
            <ul class="pagination">
              <li class="page-item" [class.disabled]="requestedPage === 0">
                <button class="page-link" (click)="onRequestedPageChange(requestedPage - 1)">Previous</button>
              </li>
              <li class="page-item" *ngFor="let page of [].constructor(requestedTotalPages); let p = index"
                [class.active]="requestedPage === p">
                <button class="page-link" (click)="onRequestedPageChange(p)">{{ p + 1 }}</button>
              </li>
              <li class="page-item" [class.disabled]="requestedPage === requestedTotalPages - 1">
                <button class="page-link" (click)="onRequestedPageChange(requestedPage + 1)">Next</button>
              </li>
            </ul>
          </nav>

        </ng-container>
        <ng-template #noRequested>
          <p>No requested students found.</p>
        </ng-template>
      </div>

      <!-- Update Student Modal -->
      <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <form (ngSubmit)="submitUpdateStudent()">
              <div class="modal-header" style=" background-color: #6a1b9a;  color: white;">
                <h2 class="modal-title" id="editStudentModalLabel"> Update Student</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="row g-3">
                  <div class="col-md-6 	sm-col-md-2 mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.name" name="studentName"
                      required />
                  </div>
                  <div class="col-md-6 sm-col-md-2 mb-3">
                    <label class="form-label">Date Of Birth</label>
                    <input type="date" class="form-control" [(ngModel)]="studentEdit.dateOfBirth"
                      name="studentDateOfbirth" />
                  </div>
                  <div class="col-md-6 sm-col-md-2 mb-3">
                    <label class="form-label">Gender</label>
                    <select class="form-select" [(ngModel)]="studentEdit.gender" name="studentGender">
                      <option value="">-- Select Gender --</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                    </select>
                  </div>
                  <div class="col-md-6 sm-col-md-2 mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" [(ngModel)]="studentEdit.email" name="studentEmail"
                      required />
                  </div>
                  <div class="col-md-6 sm-col-md-2 mb-3">
                    <label class="form-label">Phone Number</label>
                    <input type="text" class="form-control" [(ngModel)]="studentEdit.phoneNumber" name="studentPhone" />
                  </div>

                  <!-- Subject -->
                  <div class="col-md-6">
                    <label class="form-label">Subjects</label>
                    <ng-select class="form-select" [items]="hodSubjects" bindLabel="subjectName" bindValue="id"
                      [(ngModel)]="studentEdit.subjectId" name="subjectIds" [searchable]="true" [clearable]="true"
                      [multiple]="true"> <!-- ✅ Enables multiple selection -->
                    </ng-select>
                  </div>


                  <!-- Course -->
                  <div class="col-md-6">
                    <label for="editCourse" class="form-label">Course</label>
                    <ng-select class="form-select" [items]="hodCourses" bindLabel="courseName" bindValue="id"
                      [(ngModel)]="studentEdit.courseId" name="courseId" [searchable]="true" [clearable]="true">
                    </ng-select>
                  </div>

                  <div class="col-md-6 sm-col-md-2 mb-3">
                    <label class="form-label">Profile Image</label>
                    <input type="file" class="form-control" (change)="onProfileImageSelected($event)">
                  </div>
                  <div class="col-md-6 sm-col-md-2 mb-3">
                    <label class="form-label">Marksheet Image</label>
                    <input type="file" class="form-control" (change)="onMarksheetImageSelected($event)">
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn" style=" background-color: #6a1b9a;  color: white;">Save
                  Changes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="viewSection === 'hodApproved'">
      <h5 class="text-success fw-bold mb-3"> Approved Students</h5>
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="table-success">
            <tr>
              <th>#</th>
              <th>ID</th>
              <th>Name</th>
              <th>Age</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Course</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of hodApproved; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{student.id}}</td>
              <td>{{ student.name }}</td>
              <td>{{ student.age }}</td>
              <td>{{ student.email }}</td>
              <td>{{ student.phoneNumber }}</td>
              <td>{{ student.courseName }}</td>
              <td>
                <button class="btn btn-success btn-sm me-2" (click)="openEditStudentModal(student)">
                  Edit
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>


    <!-- Add Staff Modal -->
    <div class="modal fade" id="addStaffModal" tabindex="-1" aria-labelledby="addStaffModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <form (ngSubmit)="submitCreateStaff()" #staffForm="ngForm" novalidate>
            <div class="modal-header" style=" background-color: #6a1b9a;  color: white;">
              <h2 class="modal-title  fw-bold" id="addStaffModalLabel">Add New Staff</h2>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                (click)="resetStaffForm()"></button>
            </div>

            <div class="modal-body">
              <div class="row g-3">

                <!-- Name -->
                <div class="col-md-6">
                  <label class="form-label">Name<span class="text-danger"> *</span></label>
                  <input #name="ngModel" type="text" class="form-control" name="name" [(ngModel)]="newStaff.name"
                    required>
                  <div class="text-danger" *ngIf="name.invalid && (name.dirty || name.touched)">Name is required.</div>
                </div>

                <!-- Age -->
                <div class="col-md-6">
                  <label class="form-label">Age<span class="text-danger"> *</span></label>
                  <input #age="ngModel" type="number" class="form-control" name="age" [(ngModel)]="newStaff.age"
                    min="18" required>
                  <div class="text-danger" *ngIf="age.invalid && (age.dirty || age.touched)">
                    Age must be 18 or older.
                  </div>
                </div>

                <!-- Gender -->
                <div class="col-md-6">
                  <label class="form-label">Gender<span class="text-danger"> *</span></label>
                  <select #gender="ngModel" class="form-select" name="gender" [(ngModel)]="newStaff.gender" required>
                    <option value="">-- Select Gender --</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                  </select>
                  <div class="text-danger" *ngIf="gender.invalid && (gender.dirty || gender.touched)">Gender is
                    required.</div>
                </div>

                <!-- Email -->
                <div class="col-md-6">
                  <label class="form-label">Email<span class="text-danger"> *</span></label>
                  <input #email="ngModel" type="email" class="form-control" name="email" [(ngModel)]="newStaff.email"
                    required email>
                  <div class="text-danger" *ngIf="email.invalid && (email.dirty || email.touched)">
                    Valid email is required.
                  </div>
                </div>

                <!-- Phone Number -->
                <div class="col-md-6">
                  <label class="form-label">Phone Number<span class="text-danger"> *</span></label>
                  <input #phoneNumber="ngModel" type="text" class="form-control" name="phoneNumber"
                    [(ngModel)]="newStaff.phoneNumber" pattern="^[0-9]{10}$" required>
                  <div class="text-danger" *ngIf="phoneNumber.invalid && (phoneNumber.dirty || phoneNumber.touched)">
                    Phone number must be 10 digits.
                  </div>
                </div>

                <!-- Subject -->
                <div class="col-md-6">
                  <label class="form-label">Subjects</label>
                  <ng-select class="form-select" [items]="hodSubjects" bindLabel="subjectName" bindValue="id"
                    [(ngModel)]="newStaff.subjectId" name="subjectIds" [searchable]="true" [clearable]="true"
                    [multiple]="true"> <!-- ✅ Enables multiple selection -->
                  </ng-select>
                </div>


                <!-- Course -->
                <div class="col-md-6">
                  <label for="editCourse" class="form-label">Course</label>
                  <ng-select class="form-select" [items]="hodCourses" bindLabel="courseName" bindValue="id"
                    [(ngModel)]="newStaff.courseId" name="courseId" [searchable]="true" [clearable]="true">
                  </ng-select>
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button type="submit" class="btn btn-success" [disabled]="staffForm.invalid">Create Staff</button>
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"
                (click)="resetStaffForm()">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>


    <!--  All Subjects -->

    <!-- Add Subject Modal -->
    <div class="modal fade" id="addSubjectModal" tabindex="-1" aria-labelledby="addSubjectLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form (ngSubmit)="submitCreateSubject()" #addSubjectForm="ngForm">
            <div class="modal-header" style="background-color: #6a1b9a; color: white;">
              <h5 class="modal-title" id="addSubjectLabel">Add New Subject</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <label class="form-label">Subject Name</label><span class="text-danger"> *</span>
              <input type="text" class="form-control" [(ngModel)]="newSubjectName" name="newSubjectName" required
                #subjectInput="ngModel" />
              <div class="text-danger mt-1"
                *ngIf="subjectInput.invalid && (subjectInput.dirty || subjectInput.touched)">
                Subject name is required.
              </div>
            </div>

            <div class="modal-footer">
              <button type="submit" class="btn" style="background-color: #6a1b9a; color: white;"
                [disabled]="subjectInput.invalid">Create</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Subject Edit Modal -->
    <div class="modal fade" id="editSubjectModal" tabindex="-1" aria-labelledby="editSubjectLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form (ngSubmit)="UpdateHodSubject()">
            <div class="modal-header" style="background-color: #6a1b9a; color: white;">
              <h5 class="modal-title" id="editSubjectLabel">Edit Subject</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <label class="form-label">New Subject Name</label>
              <input type="text" class="form-control" [(ngModel)]="updatedSubjectName" name="updatedSubjectName"
                required>
            </div>

            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Save</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div *ngIf="viewSection === 'hodSubjects'">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-info fw-bold m-0">All Subjects</h2>
        <button class="btn btn-success" (click)="openAddSubjectModal()">
          <i class="bi bi-plus-circle me-1"></i> Add Subject
        </button>
      </div>

      <ng-container *ngIf="hodSubjects?.length && hodSubjects.length > 0; else noSubjects">
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead class="table-info">
              <tr>
                <th>S.NO</th>
                <th>Subject Name</th>
                <th>Department</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let subject of hodSubjects; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ subject.subjectName }}</td>
                <td>{{ subject.departmentName }}</td>
                <td>
                  <button class="btn btn-outline-warning btn-sm me-2"
                    (click)="openSubjectEditModal(subject.id, subject.subjectName)">
                    <i class="bi bi-pencil-square" title="Edit"></i>
                  </button>
                  <button class="btn btn-outline-danger btn-sm me-2" (click)="deleteSubjectModal(subject.id)">
                    <i class="bi bi-trash3" title="Delete"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>

      <ng-template #noSubjects>
        <p class="text-muted">No subjects found.</p>
      </ng-template>
    </div>


    <div class="modal fade" id="addCourseModal" tabindex="-1" aria-labelledby="addCourseModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form (ngSubmit)="submitCreateCourse()" #addCourseForm="ngForm" novalidate>
            <!-- Modal Header -->
            <div class="modal-header" style="background-color: #6a1b9a; color: white;">
              <h2 class="modal-title" id="addCourseModalLabel">
                <i class="bi bi-plus-circle me-2"></i> Add New Course
              </h2>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
              <!-- Course Name -->
              <div class="mb-3">
                <label for="courseName" class="form-label">Course Name <span class="text-danger">*</span></label>
                <input type="text" id="courseName" class="form-control" name="courseName" [(ngModel)]="NewCourseName"
                  #courseNameRef="ngModel" required minlength="3" />

                <div class="text-danger mt-1"
                  *ngIf="courseNameRef.invalid && (courseNameRef.dirty || courseNameRef.touched)">
                  <p>Course name is required.</p>
                </div>
              </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
              <button type="submit" style="background-color: #6a1b9a; color: white;" [disabled]="courseNameRef.invalid"
                class="btn ">Add Course</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>



    <!-- 📘 All Courses -->
    <div *ngIf="viewSection === 'hodCourses'">
      <h2 class="text-primary fw-bold mb-3">All Courses</h2>
      <div class="row mb-3">
        <div class="col-md-6">
          <input type="text" class="form-control" placeholder="Filter by Course Name" [(ngModel)]="courseSearch"
            (input)="onCourseFilterChange()" />
        </div>
      </div>
      <button class="btn btn-success mb-3" style="margin-left: 85%;" (click)="OpenNewCourseModal()">
        <i class="bi bi-person-plus-fill me-1"></i> Add Course
      </button>
      <ng-container *ngIf="courseList?.length && courseList.length > 0; else noCourses">
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead class="table-primary">
              <tr>
                <th>S.NO</th>
                <th>Course Name</th>
                <th>Staff Name</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let course of courseList; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ course.courseName }}</td>
                <td>{{ course.staffName || 'Not Assigned' }}</td>
                <td>
                  <button class="btn btn-outline-warning btn-sm me-2" (click)="openUpdateCourseModal(course)"><i
                      class="bi bi-pencil-square" title="Edit"></i></button>
                  <button class="btn btn-outline-danger btn-sm me-2" (click)="deleteCourseSwal(course.id)"><i
                      class="bi bi-trash" title="Edit"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <nav class="d-flex justify-content-center">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="coursePage === 0">
              <button class="page-link" (click)="onCoursePageChange(coursePage - 1)">Privious</button>
            </li>
            <li class="page-item" *ngFor="let p of [].constructor(courseTotalPages); let pageIndex = index"
              [class.active]="pageIndex === coursePage">
              <button class="page-link" (click)="onCoursePageChange(pageIndex)">
                {{ pageIndex + 1 }}
              </button>
            </li>
            <li class="page-item" [class.disabled]="coursePage === courseTotalPages - 1">
              <button class="page-link" (click)="onCoursePageChange(coursePage + 1)">Next</button>
            </li>
          </ul>
        </nav>
      </ng-container>
      <ng-template #noCourses>
        <p class="text-muted">No courses found.</p>
      </ng-template>
    </div>

    <!-- Update Course Modal -->
    <div class="modal fade" id="updateCourseModal" tabindex="-1" aria-labelledby="updateCourseModalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form (ngSubmit)="submitUpdatedCourse()" #updateCourseForm="ngForm">
            <div class="modal-header bg-primary text-dark">
              <h2 class="modal-title" id="updateCourseModalLabel"> Update Course</h2>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <!-- Course Name (readonly if not editable) -->
              <div class="mb-3">
                <label class="form-label">Course Name </label>
                <input type="text" class="form-control" [(ngModel)]="selectedCourse.courseName" name="CourseName" />
              </div>

              <!-- Staff Dropdown -->
              <div class="mb-3">
                <label class="form-label">Assign Staff</label>
                <input type="text" class="form-control" [(ngModel)]="selectedCourse.staffName" name="staffName" />
              </div>
            </div>

            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Update</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- View Staff Modal -->
    <div class="modal fade" id="viewStaffModal" tabindex="-1" aria-labelledby="viewStaffModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content shadow border-0 rounded-4">
          <div class="modal-header text-white"
            style="background: linear-gradient(90deg, #6a1b9a, #8e24aa); border-top-left-radius: 0.75rem; border-top-right-radius: 0.75rem;">
            <h2 class="modal-title d-flex align-items-center m-0" id="viewStaffModalLabel">
              <i class="bi bi-person-circle me-2 fs-4"></i> Staff Profile
            </h2>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body p-4" *ngIf="selectedStaff">

            <!-- Personal Details Card -->
            <div class="card shadow-sm border-0 mb-4">
              <div class="card-header bg-primary text-white">
                <i class="bi bi-person-badge-fill me-2"></i>Personal Details
              </div>
              <div class="card-body">
                <div class="row gy-3">
                  <div class="col-md-6">
                    <p><strong><i class="bi bi-person-fill me-2 text-primary"></i>Name:</strong> {{ selectedStaff.name
                      || 'N/A'}}</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong><i class="bi bi-envelope-fill me-2 text-primary"></i>Email:</strong> {{
                      selectedStaff.email || 'N/A'}}</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong><i class="bi bi-gender-ambiguous me-2 text-primary"></i>Gender:</strong> {{
                      selectedStaff.gender || 'N/A'}}</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong><i class="bi bi-calendar2-week-fill me-2 text-primary"></i>Age:</strong> {{
                      selectedStaff.age || 'N/A'}}</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong><i class="bi bi-calendar2-week-fill me-2 text-primary"></i>Date Of Birth:</strong> {{
                      selectedStaff.dateOfBirth || 'N/A'}}</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong><i class="bi bi-telephone-fill me-2 text-primary"></i>Phone:</strong> {{
                      selectedStaff.phoneNumber || 'N/A'}}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Academic Details Card -->
            <div class="card shadow-sm border-0">
              <div class="card-header bg-success text-white">
                <i class="bi bi-mortarboard-fill me-2"></i>Academic Details
              </div>
              <div class="card-body">
                <div class="row gy-3">
                  <div class="col-md-6">
                    <p><strong><i class="bi bi-book me-2 text-success"></i>Subject:</strong> {{
                      selectedStaff.subjectNme || 'Not Assigned' }}</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong><i class="bi bi-building me-2 text-success"></i>Department:</strong> {{
                      selectedStaff.departmentName }}</p>
                  </div>
                  <div class="col-md-6" *ngIf="selectedStaff.courseName">
                    <p><strong><i class="bi bi-journal-code me-2 text-success"></i>Course:</strong> {{
                      selectedStaff.courseName || 'Not Assigned'}}</p>
                  </div>
                  <div class="col-md-6" *ngIf="selectedStaff.username">
                    <p><strong><i class="bi bi-person-rolodex me-2 text-success"></i>Username:</strong> {{
                      selectedStaff.username || 'Not Assigned'}}</p>
                  </div>
                </div>
              </div>
            </div>

          </div>



          <div class="modal-footer bg-light rounded-bottom-4">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              <i class="bi bi-x-circle me-1"></i> Close
            </button>
          </div>
        </div>
      </div>
    </div>



    <!-- 👩‍🏫 All Staff -->
    <!-- Edit Staff Modal -->
    <div class="modal fade" id="editStaffModal" tabindex="-1" aria-labelledby="editStaffLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content w-100">
          <form (ngSubmit)="saveUpdatedStaff()">
            <div class="modal-header" style=" background-color: #6a1b9a;  color: white;">
              <h2 class="modal-title" id="editStaffLabel">Edit Staff</h2>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row g-3">
                <div class=" col-md-6 mb-2">
                  <label>Name</label>
                  <input type="text" class="form-control" [(ngModel)]="updatedStaff.name" name="name" required />
                </div>
                <div class="col-md-6 mb-2">
                  <label>Email</label>
                  <input type="email" class="form-control" [(ngModel)]="updatedStaff.email" name="email" required />
                </div>
                <div class="col-md-6 mb-2">
                  <label>Date Of Birth</label>
                  <input type="date" class="form-control" [(ngModel)]="updatedStaff.dateOfBirth" name="dateOfBirth"
                    required />
                </div>
                <div class="col-md-6 mb-2">
                  <label>Gender</label>
                  <select class="form-select" [(ngModel)]="updatedStaff.gender" name="gender" required>
                    <option value="">-- Select Gender --</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                  </select>
                </div>
                <div class="col-md-6 mb-2">
                  <label>Phone Number</label>
                  <input type="text" class="form-control" [(ngModel)]="updatedStaff.phoneNumber" name="phoneNumber"
                    required />
                </div>
                <!-- Subject -->
                <div class="col-md-6">
                  <label class="form-label">Subjects</label>
                  <ng-select class="form-select" [items]="hodSubjects" bindLabel="subjectName" bindValue="id"
                    [(ngModel)]="updatedStaff.subjectId" name="subjectIds" [searchable]="true" [clearable]="true"
                    [multiple]="true"> <!-- ✅ Enables multiple selection -->
                  </ng-select>
                </div>


                <!-- Course -->
                <div class="col-md-6">
                  <label for="editCourse" class="form-label">Course</label>
                  <ng-select class="form-select" [items]="hodCourses" bindLabel="courseName" bindValue="id"
                    [(ngModel)]="updatedStaff.courseId" name="courseId" [searchable]="true" [clearable]="true">
                  </ng-select>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn " type="submit" style=" background-color: #6a1b9a;  color: white;">Update</button>
              <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>


    <div *ngIf="viewSection === 'hodStaff'">
      <h2 class="text-primary fw-bold mb-3">Staff's List</h2>
      <button class="btn btn-success mb-3" style="margin-left: 85%;" (click)="openAddStaffModal()">
        <i class="bi bi-person-plus-fill me-1"></i> Add Staff
      </button>

      <ng-container *ngIf="hodStaff?.length && hodStaff.length > 0; else noStaff">
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead class="table-secondary">
              <tr>
                <th>S.NO</th>
                <th>Name</th>
                <th>Phone</th>
                <th>Subject</th>
                <th>Course</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let staff of hodStaff; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ staff.name }}</td>
                <td>{{ staff.phoneNumber }}</td>
                <td>{{ staff.subjectNme || ['N/A'] }}</td>
                <td>{{ staff.courseName || 'N/A' }}</td>
                <td>
                  <button class="btn btn-outline-info me-2 btn-sm" (click)="openViewStaffModal(staff)">
                    <i class="bi bi-eye-fill" title="View"></i>
                  </button>

                  <button class="btn btn-outline-warning btn-sm me-2" (click)="openUpdateStaffModal(staff)"><i
                      class="bi bi-pencil-square" title="Edit"></i></button>
                  <button class="btn btn-outline-danger btn-sm me-2" (click)="deleteStuffModel(staff)"><i
                      class="bi bi-trash" title="Delete"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>

      <ng-template #noStaff>
        <p class="text-muted">No staff members found.</p>
      </ng-template>
    </div>



    <!-- Staff View ------------------------------------------------------>
    <div *ngIf="hasRole('ROLE_STAFF')" class="student-dashboard py-5">

      <!-- Common Table -->
      <div *ngIf="viewSection === 'pending'">
        <h2 class="text-primary fw-bold mb-3">Course Students</h2>

        <!-- Filters -->
        <div class="row mb-3">
          <div class="col-md-6">
            <input type="text" class="form-control" placeholder="Search by name" [(ngModel)]="studentSearch"
              (input)="onCourseStudentFilterChange()" />
          </div>
          <div class="col-md-6">
            <select class="form-select" [(ngModel)]="studentStatusFilter" (change)="onCourseStudentFilterChange()">
              <option value="">ALL STATUS</option>
              <option value="PENDING">PENDING</option>
              <option value="APPROVED">APPROVED</option>
              <option value="REJECTED">REJECTED</option>
            </select>
          </div>
        </div>

        <ng-container *ngIf="pendingStudents?.length && pendingStudents.length > 0; else noPending">
          <table class="table table-bordered table-striped">
            <thead class="table-info">
              <tr>
                <th>#</th>
                <th>Student</th>
                <th>Department</th>
                <th>Email</th>
                <th>Course</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of pendingStudents; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ student.studentName }}</td>
                <td>{{ student.departmentName }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.courseName }}</td>
                <td>{{student.status}}</td>
                <td>
                  <button class="btn btn-success btn-sm me-2"
                    (click)="confirmStudentAction(student.id, 'approveByStaff')" title="Approve"><i
                      class="bi bi-check-circle"></i></button>
                  <button class="btn btn-danger btn-sm" (click)="confirmStudentAction(student.id, 'rejectByStaff')"
                    title="Reject"><i class="bi bi-x-circle"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>

        <nav class="d-flex justify-content-center mt-3">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="studentPage === 0">
              <button class="page-link" (click)="onCourseStudentPageChange(studentPage - 1)">Previous</button>
            </li>
            <li class="page-item" *ngFor="let p of [].constructor(studentTotalPages); let i = index"
              [class.active]="i === studentPage">
              <button class="page-link" (click)="onCourseStudentPageChange(i)">{{ i + 1 }}</button>
            </li>
            <li class="page-item" [class.disabled]="studentPage === studentTotalPages - 1">
              <button class="page-link" (click)="onCourseStudentPageChange(studentPage + 1)">Next</button>
            </li>
          </ul>
        </nav>

        <ng-template #noPending>
          <p>No pending students found.</p>
        </ng-template>
      </div>

      <div *ngIf="viewSection === 'subjectStudents'">
        <h2 class="text-info fw-bold mb-3">Students Under Your Subject</h2>

        <!-- Filters -->
        <div class="row mb-3">
          <div class="col-md-6">
            <input type="text" class="form-control" placeholder="Filter by name" [(ngModel)]="subjectStudentFilterName"
              (input)="onSubjectStudentFilterChange()" />
          </div>
        </div>

        <ng-container *ngIf="subjectStudents?.length && subjectStudents.length > 0; else noSubjectStudents">
          <table class="table table-bordered table-hover">
            <thead class="table-light">
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Subject</th>
                <th>Department</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let student of subjectStudents; let i = index">
                <td>{{ subjectStudentPage * subjectStudentSize + i + 1 }}</td>
                <td>{{ student.name }}</td>
                <td>{{ student.email }}</td>
                <td>{{student.subjectName}}</td>
                <td>{{ student.departmentName }}</td>
              </tr>
            </tbody>
          </table>

          <!-- Pagination -->
          <nav class="d-flex justify-content-center">
            <ul class="pagination">
              <li class="page-item" [class.disabled]="subjectStudentPage === 0">
                <button class="page-link" (click)="onSubjectStudentPageChange(subjectStudentPage - 1)">Previous</button>
              </li>
              <li class="page-item" *ngFor="let p of [].constructor(subjectStudentTotalPages); let pageIndex = index"
                [class.active]="subjectStudentPage === pageIndex">
                <button class="page-link" (click)="onSubjectStudentPageChange(pageIndex)">
                  {{ pageIndex + 1 }}
                </button>
              </li>
              <li class="page-item" [class.disabled]="subjectStudentPage === subjectStudentTotalPages - 1">
                <button class="page-link" (click)="onSubjectStudentPageChange(subjectStudentPage + 1)">Next</button>
              </li>
            </ul>
          </nav>
        </ng-container>

        <ng-template #noSubjectStudents>
          <div class="alert alert-info text-center mt-3">
            No students found under your subjects.
          </div>
        </ng-template>
      </div>

      <div *ngIf="viewSection === 'StaffInfo'" class="card shadow-sm border-0 mb-4 bg-light p-4">
        <div class="row g-4 align-items-center">
          <!-- Profile Image & Basic Info -->
          <div class="col-md-4 text-center">
            <img
              [src]="staffInfo.profileImagePath ? 'http://localhost:8080' + staffInfo.profileImagePath : 'http://localhost:8080/uploads/assets/default-profile.png'"
              alt="Profile Image" class="img-fluid rounded-circle border border-3 border-primary shadow"
              style="width: 150px; height: 150px; object-fit: cover;" />
            <h5 class="mt-3 text-primary fw-bold mb-1">{{ staffInfo.name }}</h5>
            <p class="text-muted mb-0">{{ staffInfo.email }}</p>
          </div>

          <!-- Details Section -->
          <div class="col-md-8">
            <div class="row row-cols-1 row-cols-sm-2 g-3">
              <div class="col">
                <div class="bg-white rounded shadow-sm p-3 h-100">
                  <h4 class="mb-3 text-primary">Staff Personal Details</h4>
                  <p class="mb-1"><strong>Age:</strong> {{ staffInfo.age }}</p>
                  <p class="mb-1"><strong>Gender:</strong> {{ staffInfo.gender }}</p>
                  <p class="mb-1"><strong>Phone:</strong> {{ staffInfo.phoneNumber }}</p>
                </div>
              </div>
              <div class="col">
                <div class="bg-white rounded shadow-sm p-3 h-100">
                  <h4 class="mb-3 text-primary">Academic Details</h4>
                  <p class="mb-1"><strong>Department:</strong> {{ staffInfo.departmentName }}</p>
                  <p class="mb-1"><strong>Subject:</strong>
                    {{ staffInfo.subjectNme?.toUpperCase() || 'Not Assigned' }}</p>
                  <p class="mb-1"><strong>Course:</strong>
                    {{ staffInfo.courseName?.toUpperCase() || 'Not Assigned' }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Student View ---------------------------------------------------------------------------------------------------->
    <div *ngIf="hasRole('ROLE_STUDENT')" class="student-dashboard py-5">

      <!-- Profile Section -->
      <!-- Profile Section -->
      <div *ngIf="viewSection === 'profile'" class="card shadow-sm border-1 mb-4 mt-4">
        <div class="card-body ">
          <h3 class="mb-4 text-primary d-flex align-items-center">
            <i class="bi bi-person-circle me-2 fs-4"></i> Student Profile
          </h3>

          <ng-container *ngIf="studentProfile; else loadingProfile">
            <div class="row g-4">
              <!-- Profile Image -->
              <div class="col-md-4 text-center">
                <img
                  [src]="studentProfile?.profileImagePath ? 'http://localhost:8080' + studentProfile.profileImagePath : 'http://localhost:8080/uploads/assets/default-profile.png'"
                  class="img-fluid rounded-circle border border-3 border-primary profile-thumbnail" alt="Profile Image"
                  style="width: 150px; height: 150px; object-fit: cover;" />
                <h5 class="mt-3 text-dark">{{ studentProfile?.name }}</h5>
                <p class="text-muted mb-0">{{ studentProfile?.email }}</p>
                <p class="text-muted">{{ studentProfile?.phoneNumber }}</p>
              </div>

              <!-- Profile Info -->
              <div class="col-md-8">
                <div class="row g-3">
                  <div class="col-sm-6">
                    <div class="border rounded p-2 bg-light">
                      <strong class="text-muted">Department</strong>
                      <div>{{ studentProfile?.departmentName || 'N/A' }}</div>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="border rounded p-2 bg-light">
                      <strong class="text-muted">Course</strong>
                      <div>{{ studentProfile?.courseName || 'N/A' }}</div>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="border rounded p-2 bg-light">
                      <strong class="text-muted">Subject</strong>
                      <ul class="list-styled ">
                        <li class="pt-0" *ngFor="let subject of studentProfile?.subjectName || ['N/A']">
                          <p class="small">{{ subject }}</p>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>

          <ng-template #loadingProfile>
            <div class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-2">Loading profile...</p>
            </div>
          </ng-template>
        </div>
      </div>


      <!-- Courses Section -->
      <!-- Available Courses -->
      <!-- Available Courses (Grid Layout) -->
      <div *ngIf="viewSection === 'courses'" class="card shadow-sm border-0 p-4 mb-4">
        <h4 class="mb-4 text-purple d-flex align-items-center">
          <i class="bi bi-book-fill me-2 fs-5"></i> Available Courses
        </h4>
        <!-- Filter Input -->
        <div class="mb-3 row g-2 align-items-center">
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder=" Search courses" [(ngModel)]="courseSearch"
              (input)="onCourseFilterChange()" />
          </div>
        </div>

        <ng-container *ngIf="courseList?.length && courseList.length > 0; else noCourses">
          <div *ngIf="loader" class="backdrop">
            <div class="spinner"></div>
          </div>
          <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
            <div *ngFor="let course of courseList; let i = index" class="col-12 col-sm-6 col-md-4 col-lg-3">
              <div class="card course-card h-100 shadow-sm border-0 p-3">
                <div class="card-body d-flex flex-column justify-content-between">
                  <div>
                    <h4 class="fw-bold  mb-2">
                      <i class="bi bi-journal-bookmark-fill me-2"></i>{{ course.courseName }}
                    </h4>
                    <p class=" small">
                      <i class="bi bi-person-circle me-1"></i>
                      {{ course.staffName || 'Staff Not Assigned' }}
                    </p>
                  </div>
                  <button class="btn btn-outline-warning  btn-sm w-50 mt-3" (click)="confirmCourseEnroll(course.id)">
                    <i class="bi bi-check-circle-fill me-1"></i> Enroll
                  </button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- Pagination Controls -->
        <nav class="d-flex justify-content-center mt-3">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="coursePage === 0">
              <button class="page-link" (click)="onStudCoursePageChange(coursePage - 1)">Previous</button>
            </li>
            <li class="page-item" *ngFor="let p of [].constructor(courseTotalPages); let i = index"
              [class.active]="coursePage === i">
              <button class="page-link" (click)="onStudCoursePageChange(i)">{{ i + 1 }}</button>
            </li>
            <li class="page-item" [class.disabled]="coursePage === courseTotalPages - 1">
              <button class="page-link" (click)="onStudCoursePageChange(coursePage + 1)">Next</button>
            </li>
          </ul>
        </nav>
        <!-- No Courses Template -->
        <ng-template #noCourses>
          <div class="alert alert-info text-center mt-3">
            <i class="bi bi-exclamation-circle me-1"></i>
            No courses available at the moment.
          </div>
        </ng-template>
      </div>


      <!-- Department Info Section -->
      <!-- Department Info Section (Modern Style) -->
      <div *ngIf="viewSection === 'department'" class="card shadow-sm border-0 p-4 mb-4 bg-light">
        <h4 class="mb-4 text-purple d-flex align-items-center">
          <i class="bi bi-building me-2 fs-5"></i> Department Information
        </h4>

        <ng-container *ngIf="departmentInfo; else loadingDept">
          <div class="mb-3">
            <p class="mb-1"><strong class="text-dark">Department:</strong> {{ departmentInfo.departmentName }}</p>
            <p class="mb-1">
              <strong class="text-dark">Head of Department:</strong>
              {{ departmentInfo.hodName }} <small class="text-muted">({{ departmentInfo.hodEmail }})</small>
            </p>
          </div>

          <div>
            <h6 class="text-secondary fw-bold"> Staff Members</h6>
            <ul class="list-group list-group-flush shadow-sm rounded">
              <ng-container *ngIf="departmentInfo.staffNames?.length > 0; else noStaff">
                <li *ngFor="let staff of departmentInfo.staffNames; let i = index"
                  class="list-group-item d-flex justify-content-start align-items-center staff-hover">
                  <i class="bi bi-person-fill me-2 text-primary"></i>
                  {{ i + 1 }}. {{ staff }}
                </li>
              </ng-container>
              <ng-template #noStaff>
                <li class="list-group-item text-muted">No Staff Found</li>
              </ng-template>
            </ul>
          </div>
        </ng-container>
        <ng-template #loadingDept>
          <div class="alert alert-info mt-3">
            <i class="bi bi-info-circle me-2"></i> No department info available...
          </div>
        </ng-template>
      </div>

    </div>
  </div>
</body>