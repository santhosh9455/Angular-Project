<app-navbar></app-navbar>

<!-- Admin View -->
<div *ngIf="hasRole('ROLE_ADMIN')">
  <h4 class="text-secondary">ğŸ‘¤ {{ username }}</h4>
  <p>You are an <strong>Admin</strong>.</p>
</div>

<!-- HOD View Section -->
<div *ngIf="hasRole('ROLE_HOD')" class="hod-dashboard py-5">
  <h2 class="mb-4 text-center text-white bg-primary rounded p-3 mt-4">Welcome {{ username }} to ğŸ§‘â€ğŸ’¼ HOD Dashboard</h2>

  <div class="d-flex flex-wrap justify-content-center gap-3 mb-4">
    <button class="student-btn" (click)="toggleSection('hodRequested')">Requested Students</button>
    <button class="student-btn" (click)="toggleSection('hodApproved')">Approved Students</button>
    <button class="student-btn" (click)="toggleSection('hodRejected')">Rejected Students</button>
    <button class="student-btn" (click)="toggleSection('hodCreateStaff')">Create Staff</button>
    <button class="student-btn" (click)="toggleSection('hodCreateSubject')">Create Subject</button>
    <button class="student-btn" (click)="toggleSection('hodCreateCourse')">Create Course</button>
    <button class="student-btn" (click)="toggleSection('hodStaff')">All Staff</button>
    <button class="student-btn" (click)="toggleSection('hodCourses')">All Courses</button>
    <button class="student-btn" (click)="toggleSection('hodSubjects')">All Subjects</button>
  </div>

  <!-- Requested Students Table -->
  <div *ngIf="viewSection === 'hodRequested'">
    <h5 class="text-primary fw-bold mb-3">ğŸ“Œ Requested Students</h5>
    <ng-container *ngIf="hodRequested?.length && hodRequested.length > 0; else noRequested">
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Department</th>
            <th>Status </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of hodRequested; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ student.name }}</td>
            <td>{{ student.email }}</td>
            <td>{{ student.phoneNumber }}</td>
            <td>{{ student.departmentName }}</td>
            <td>{{ student.status }}</td>
            <td>
              <button class="btn btn-success btn-sm me-2" (click)="approveHodStudent(student.id)">Approve</button>
              <button class="btn btn-danger btn-sm" (click)="rejectHodStudent(student.id)">Reject</button>
            </td>
          </tr>
        </tbody>
      </table>
    </ng-container>
    <ng-template #noRequested>
      <p>No requested students found.</p>
    </ng-template>
  </div>

  <!-- âœ… Approved Students -->
  <div *ngIf="viewSection === 'hodApproved'">
    <h5 class="text-success fw-bold mb-3">âœ… Approved Students</h5>
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-success">
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Course</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of hodApproved; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ student.name }}</td>
            <td>{{ student.courseName }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- âŒ Rejected Students -->
  <div *ngIf="viewSection === 'hodRejected'">
    <h5 class="text-danger fw-bold mb-3">âŒ Rejected Students</h5>
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-danger">
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Course</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of hodRejected; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ student.name }}</td>
            <td>{{ student.courseName }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ğŸ“š All Subjects -->
  <div *ngIf="viewSection === 'hodSubjects'">
    <h5 class="text-info fw-bold mb-3">ğŸ“š All Subjects</h5>
    <ng-container *ngIf="hodSubjects?.length && hodSubjects.length > 0; else noSubjects">
      <div class="table-responsive">
        <table class="table table-bordered table-striped">
          <thead class="table-info">
            <tr>
              <th>#</th>
              <th>Subject Name</th>
              <th>Department</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let subject of hodSubjects; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ subject.subjectName }}</td>
              <td>{{ subject.departmentName }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-container>
    <ng-template #noSubjects>
      <p class="text-muted">No subjects found.</p>
    </ng-template>
  </div>

  <!-- ğŸ“˜ All Courses -->
  <div *ngIf="viewSection === 'hodCourses'">
    <h5 class="text-primary fw-bold mb-3">ğŸ“˜ All Courses</h5>
    <ng-container *ngIf="hodCourses?.length && hodCourses.length > 0; else noCourses">
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="table-primary">
            <tr>
              <th>#</th>
              <th>Course Name</th>
              <th>Staff Name</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let course of hodCourses; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ course.courseName }}</td>
              <td>{{ course.staffName }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-container>
    <ng-template #noCourses>
      <p class="text-muted">No courses found.</p>
    </ng-template>
  </div>

  <!-- ğŸ‘©â€ğŸ« All Staff -->
  <div *ngIf="viewSection === 'hodStaff'">
    <h5 class="text-secondary fw-bold mb-3">ğŸ‘©â€ğŸ« Staff Members</h5>
    <ng-container *ngIf="hodStaff?.length && hodStaff.length > 0; else noStaff">
      <div class="table-responsive">
        <table class="table table-bordered table-striped">
          <thead class="table-secondary">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Email</th>
              <th>Gender</th>
              <th>Phone</th>
              <th>Subject</th>
              <th>Course</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let staff of hodStaff; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ staff.name }}</td>
              <td>{{ staff.email }}</td>
              <td>{{ staff.gender }}</td>
              <td>{{ staff.phoneNumber }}</td>
              <td>{{ staff.subjectName }}</td>
              <td>{{ staff.courseName }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-container>

    <ng-template #noStaff>
      <p class="text-muted">No staff members found.</p>
    </ng-template>
  </div>
</div>



<!-- Staff View -->
<div *ngIf="hasRole('ROLE_STAFF')" class="student-dashboard py-5">
  <h2 class="mb-4 text-center text-white bg-primary rounded p-3 mt-4">Welcome {{ username }} to ğŸ‘¨â€ğŸ« Dashboard</h2>
  <div class="d-flex justify-content-center gap-3 mb-4">
    <button class="student-btn" (click)="toggleSection('pending')"> Pending Students</button>
    <button class="student-btn" (click)="toggleSection('approved')">Approved Students</button>
    <button class="student-btn" (click)="toggleSection('rejected')"> Rejected Students</button>
    <button class="student-btn" (click)="toggleSection('subjectStudents')">Subject Students</button>
    <button class="student-btn" (click)="toggleSection('staffInfo')">My Profile</button>
    <button class="student-btn" (click)="toggleSection('allStudents')">All Students</button>
  </div>

  <!-- Common Table -->
  <div *ngIf="viewSection === 'pending'">
    <h5 class="text-primary fw-bold mb-3">ğŸ“Œ Pending Course Requests</h5>
    <ng-container *ngIf="pendingStudents?.length && pendingStudents.length > 0; else noPending">
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>#</th>
            <th>Student</th>
            <th>Department</th>
            <th>Email</th>
            <th>Course</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of pendingStudents; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ student.studentName }}</td>
            <td>{{ student.departmentName }}</td>
            <td>{{ student.email }}</td>
            <td>{{ student.courseName }}</td>
            <td>
              <button class="btn btn-success btn-sm me-2" (click)="approveStudent(student.id)">Approve</button>
              <button class="btn btn-danger btn-sm" (click)="rejectStudent(student.id)">Reject</button>
            </td>
          </tr>
        </tbody>
      </table>
    </ng-container>
    <ng-template #noPending>
      <p>No pending students found.</p>
    </ng-template>
  </div>

  <!-- Approved Students -->
  <div *ngIf="viewSection === 'approved'">
    <h5 class="text-success fw-bold mb-3">âœ… Approved Students</h5>
    <ng-container *ngIf="approvedStudents?.length && approvedStudents.length > 0; else noApproved">

      <ul class="list-group">
        <li *ngFor="let student of approvedStudents" class="list-group-item">
          {{ student.studentName }} - {{ student.courseName }}
        </li>
      </ul>
    </ng-container>
    <ng-template #noApproved>
      <p>No approved students found.</p>
    </ng-template>
  </div>

  <!-- Rejected Students -->
  <div *ngIf="viewSection === 'rejected'">
    <h5 class="text-danger fw-bold mb-3">Rejected Students</h5>
    <ng-container *ngIf="rejectedStudents?.length && rejectedStudents.length > 0; else noRejected">

      <ul class="list-group">
        <li *ngFor="let student of rejectedStudents" class="list-group-item">
          {{ student.studentName }} - {{ student.courseName }}
        </li>
      </ul>
    </ng-container>
    <ng-template #noRejected>
      <p>No rejected students found.</p>
    </ng-template>
  </div>
  <div *ngIf="viewSection === 'subjectStudents'">
    <h5 class="text-info fw-bold mb-3">ğŸ“š Students Under Your Subjects</h5>
    <ul class="list-group">
      <li *ngFor="let student of subjectStudents" class="list-group-item">
        {{ student.name }} - {{ student.email }}
      </li>
    </ul>
  </div>
  <div *ngIf="viewSection === 'staffInfo'">
    <h5 class="text-dark fw-bold mb-3">ğŸ‘¨â€ğŸ« My Profile</h5>
    <p><strong>Name:</strong> {{ staffInfo.name }}</p>
    <p><strong>Email:</strong> {{ staffInfo.email }}</p>
    <p><strong>Department:</strong> {{ staffInfo.departmentName }}</p>
  </div>
  <div *ngIf="viewSection === 'allStudents'">
    <h5 class="text-secondary fw-bold mb-3">ğŸ“‹ All Course Request Students</h5>
    <ul class="list-group">
      <li *ngFor="let student of allStudents" class="list-group-item">
        {{ student.studentName }} - {{ student.courseName }}
      </li>
    </ul>
  </div>

</div>

<!-- Student View -->
<div *ngIf="hasRole('ROLE_STUDENT')" class="student-dashboard py-5">
  <h2 class="mb-4 text-center text-white bg-primary rounded p-3 mt-4">ğŸ“ Student Dashboard</h2>

  <div class="d-flex justify-content-center gap-3 mb-4">
    <button class="student-btn" (click)="toggleSection('profile')">ğŸ‘¤ Profile</button>
    <button class="student-btn" (click)="toggleSection('courses')">ğŸ“š Courses</button>
    <button class="student-btn" (click)="toggleSection('department')">ğŸ« Department Info</button>
  </div>

  <!-- Profile Section -->
  <div *ngIf="viewSection === 'profile'" class="card p-3 mb-4">
    <h5 class="mb-3" style="color: #6a1b9a;">ğŸ‘¤ Profile</h5>
    <ng-container *ngIf="studentProfile; else loadingProfile">
      <ul class="list-group">
        <li class="list-group-item"><strong>Name:</strong> {{ studentProfile?.name }}</li>
        <li class="list-group-item"><strong>Email:</strong> {{ studentProfile?.email }}</li>
        <li class="list-group-item"><strong>Phone:</strong> {{ studentProfile?.phoneNumber }}</li>
        <li class="list-group-item"><strong>Department:</strong> {{ studentProfile?.departmentName }}</li>
        <li class="list-group-item"><strong>Course Name:</strong> {{ studentProfile?.courseName }}</li>
        <li class="list-group-item"><strong>Subject Name:</strong> {{ studentProfile?.subjectName }}</li>
      </ul>
    </ng-container>
    <ng-template #loadingProfile>
      <p>Loading profile...</p>
    </ng-template>
  </div>

  <!-- Courses Section -->
  <div *ngIf="viewSection === 'courses'" class="card p-3 mb-4">
    <h5 class="mb-3" style="color: #6a1b9a;">ğŸ“š Available Courses</h5>
    <ng-container *ngIf="courseList?.length && courseList.length > 0; else noCourses">
      <ul class="list-group">
        <li *ngFor="let course of courseList; let i = index"
          class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <strong>{{ i + 1 }}:</strong> {{ course.courseName }}<br />
            <small>ğŸ‘¨â€ğŸ« {{ course.staffName || 'Staff Not Assigned' }}</small>
          </div>
          <button class="btn btn-sm btn-outline-primary" (click)="registerCourse(course.id)">Enroll</button>
        </li>
      </ul>
    </ng-container>
    <ng-template #noCourses>
      <p>No courses available at the moment.</p>
    </ng-template>
  </div>

  <!-- Department Info Section -->
  <div *ngIf="viewSection === 'department'" class="card p-3 mb-4">
    <h5 class="mb-3" style="color: #6a1b9a;">ğŸ« Department Information</h5>
    <ng-container *ngIf="departmentInfo; else loadingDept">
      <p><strong>Department Name:</strong> {{ departmentInfo?.departmentName }}</p>
      <p><strong>HOD:</strong> {{ departmentInfo?.hodName }} ({{ departmentInfo?.hodEmail }})</p>
      <p><strong>Staff Members:</strong></p>
      <ul class="list-group">
        <li *ngFor="let staff of departmentInfo?.staffNames; let i = index" class="list-group-item">
          {{ i + 1 }}. {{ staff }}
        </li>
      </ul>
    </ng-container>
    <ng-template #loadingDept>
      <p>Loading department info...</p>
    </ng-template>
  </div>
</div>